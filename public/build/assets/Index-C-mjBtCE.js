import{r as s,j as e,a as H,b as q,c as me,H as pe,L as Y}from"./app-SoRLWay0.js";import{A as ge}from"./AppLayout-BnFOcWJR.js";import{B}from"./Button-CGE1DzVd.js";import{M as G}from"./Modal-t-7ADvTk.js";function fe(t,l,n,a){var c=this,h=s.useRef(null),u=s.useRef(0),w=s.useRef(0),f=s.useRef(null),i=s.useRef([]),r=s.useRef(),o=s.useRef(),b=s.useRef(t),m=s.useRef(!0),j=s.useRef(),F=s.useRef();b.current=t;var R=typeof window<"u",D=!l&&l!==0&&R;if(typeof t!="function")throw new TypeError("Expected a function");l=+l||0;var A=!!(n=n||{}).leading,y=!("trailing"in n)||!!n.trailing,E=!!n.flushOnExit&&y,P="maxWait"in n,k="debounceOnServer"in n&&!!n.debounceOnServer,L=P?Math.max(+n.maxWait||0,l):null,p=s.useMemo(function(){var M=function(C){var S=i.current,z=r.current;return i.current=r.current=null,u.current=C,w.current=w.current||C,o.current=b.current.apply(z,S)},$=function(C,S){D&&cancelAnimationFrame(f.current),f.current=D?requestAnimationFrame(C):setTimeout(C,S)},O=function(C){if(!m.current)return!1;var S=C-h.current;return!h.current||S>=l||S<0||P&&C-u.current>=L},d=function(C){return f.current=null,y&&i.current?M(C):(i.current=r.current=null,o.current)},g=function C(){var S=Date.now();if(A&&w.current===u.current&&v(),O(S))return d(S);if(m.current){var z=l-(S-h.current),_=P?Math.min(z,L-(S-u.current)):z;$(C,_)}},v=function(){},N=function(){if(R||k){var C,S=Date.now(),z=O(S);if(i.current=[].slice.call(arguments),r.current=c,h.current=S,E&&!j.current&&(j.current=function(){var _;((_=global.document)==null?void 0:_.visibilityState)==="hidden"&&F.current.flush()},(C=global.document)==null||C.addEventListener==null||C.addEventListener("visibilitychange",j.current)),z){if(!f.current&&m.current)return u.current=h.current,$(g,l),A?M(h.current):o.current;if(P)return $(g,l),M(h.current)}return f.current||$(g,l),o.current}};return N.cancel=function(){var C=f.current;C&&(D?cancelAnimationFrame(f.current):clearTimeout(f.current)),u.current=0,i.current=h.current=r.current=f.current=null},N.isPending=function(){return!!f.current},N.flush=function(){return f.current?d(Date.now()):o.current},N},[A,P,l,L,y,E,D,R,k,a]);return F.current=p,s.useEffect(function(){return m.current=!0,function(){var M;E&&F.current.flush(),j.current&&((M=global.document)==null||M.removeEventListener==null||M.removeEventListener("visibilitychange",j.current),j.current=null),m.current=!1}},[E]),p}function ve(t){const[l,n]=s.useState(!1),[a,c]=s.useState(!1),[h,u]=s.useState(null);s.useEffect(()=>{const i=window.SpeechRecognition||window.webkitSpeechRecognition;c(!!i)},[]);const w=s.useCallback(()=>{if(!a){u("Voice search is not supported in this browser");return}const i=window.SpeechRecognition||window.webkitSpeechRecognition,r=new i;r.continuous=!1,r.interimResults=!1,r.lang="en-US",r.onstart=()=>{n(!0),u(null)},r.onresult=o=>{const b=o.results[0][0].transcript;t(b),n(!1)},r.onerror=o=>{u(o.error==="not-allowed"?"Microphone access denied":"Voice search error: "+o.error),n(!1)},r.onend=()=>{n(!1)};try{r.start()}catch{u("Failed to start voice search"),n(!1)}},[a,t]),f=s.useCallback(()=>{n(!1)},[]);return{isListening:l,isSupported:a,error:h,startListening:w,stopListening:f}}function je({onResult:t}){const{isListening:l,isSupported:n,error:a,startListening:c}=ve(t);return n?e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:c,disabled:l,className:`p-1.5 rounded-md transition-colors ${l?"text-primary bg-primary-light":"text-text-secondary hover:text-text-primary hover:bg-gray-100"}`,title:l?"Listening...":"Voice search",children:e.jsxs("div",{className:"relative",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})}),l&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-error rounded-full voice-active"})]})}),a&&e.jsx("div",{className:"absolute top-full right-0 mt-2 px-3 py-2 bg-error text-white text-xs rounded-lg whitespace-nowrap z-10",children:a})]}):null}function ye({initialValue:t="",placeholder:l="Search files..."}){const[n,a]=s.useState(t),[c,h]=s.useState(!1),u=fe(r=>{H.get(window.location.pathname,{...Object.fromEntries(new URLSearchParams(window.location.search)),search:r||void 0},{preserveState:!0,preserveScroll:!0})},300),w=r=>{const o=r.target.value;a(o),u(o)},f=s.useCallback(r=>{a(r),u(r)},[u]),i=()=>{a(""),u("")};return e.jsx("div",{className:"relative flex items-center",children:e.jsxs("div",{className:`relative flex-1 transition-all duration-200 ${c?"scale-[1.02]":""}`,children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx("svg",{className:`h-5 w-5 transition-colors ${c?"text-primary":"text-text-secondary"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:n,onChange:w,onFocus:()=>h(!0),onBlur:()=>h(!1),placeholder:l,className:`block w-full pl-12 pr-24 py-3 border rounded-xl bg-card text-text-primary placeholder-text-secondary transition-all duration-200 ${c?"border-primary ring-4 ring-primary/10 shadow-lg":"border-border hover:border-gray-300 shadow-sm"}`}),e.jsxs("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 gap-1",children:[n&&e.jsx("button",{onClick:i,className:"p-2 rounded-lg text-text-secondary hover:text-text-primary hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx(je,{onResult:f})]})]})})}function oe({size:t="sm"}){const l={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"};return e.jsx("div",{className:"inline-flex items-center justify-center text-primary",title:"This file is shared",children:e.jsx("svg",{className:l[t],fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})})}function be({file:t,selected:l,onSelect:n,onContextMenu:a,onPreview:c,onDownload:h,onShare:u}){const[w,f]=s.useState(!1),[i,r]=s.useState(!1),o=s.useRef(null);s.useEffect(()=>{const y=E=>{o.current&&!o.current.contains(E.target)&&r(!1)};return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[]);const b=y=>{const E={image:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),video:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),audio:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),document:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),archive:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),file:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})};return E[y]||E.file},m={image:"text-green-500 bg-green-50",video:"text-purple-500 bg-purple-50",audio:"text-pink-500 bg-pink-50",document:"text-blue-500 bg-blue-50",archive:"text-yellow-500 bg-yellow-50",file:"text-gray-500 bg-gray-50"},j=t.icon_type==="image",F=t.icon_type==="video",R=j||F,D=y=>{y.ctrlKey||y.metaKey?n(t.id):R&&c&&c(t)},A=()=>{h&&h(t)};return e.jsxs("div",{className:`group relative bg-card border rounded-2xl p-4 transition-all duration-200 cursor-pointer card-hover ${l?"border-primary ring-2 ring-primary/20 shadow-md":"border-border hover:border-primary/40 hover:shadow-lg"}`,onClick:D,onDoubleClick:A,onContextMenu:y=>{y.preventDefault(),a(y,t)},children:[e.jsx("div",{className:`absolute top-3 left-3 w-5 h-5 rounded-lg border-2 flex items-center justify-center transition-all duration-200 z-10 ${l?"bg-primary border-primary shadow-sm":"border-border bg-white opacity-0 group-hover:opacity-100 hover:border-primary/50"}`,onClick:y=>{y.stopPropagation(),n(t.id)},children:l&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"absolute top-3 right-3 z-10",ref:o,children:[e.jsx("button",{className:`p-1.5 rounded-xl transition-all duration-200 ${i?"bg-gray-100 opacity-100":"hover:bg-gray-100 opacity-0 group-hover:opacity-100"}`,onClick:y=>{y.stopPropagation(),r(!i)},children:e.jsx("svg",{className:"w-5 h-5 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),i&&e.jsxs("div",{className:"absolute right-0 mt-1 w-44 bg-card rounded-xl shadow-xl border border-border py-1.5 slide-up",children:[R&&c&&e.jsxs("button",{onClick:y=>{y.stopPropagation(),r(!1),c(t)},className:"w-full px-4 py-2.5 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Preview"]}),e.jsxs("button",{onClick:y=>{y.stopPropagation(),r(!1),h&&h(t)},className:"w-full px-4 py-2.5 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]}),u&&e.jsxs("button",{onClick:y=>{y.stopPropagation(),r(!1),u(t)},className:"w-full px-4 py-2.5 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Share"]}),e.jsx("div",{className:"my-1.5 border-t border-border"}),e.jsxs("button",{onClick:y=>{y.stopPropagation(),r(!1),a(y,t)},className:"w-full px-4 py-2.5 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"More options..."]})]})]}),e.jsx("div",{className:"flex justify-center mb-4 mt-2",children:j&&!w?e.jsx("div",{className:"w-full h-32 rounded-xl overflow-hidden bg-gray-100 relative",children:e.jsx("img",{src:t.thumbnail_url||`/files/${t.id}/download`,alt:t.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",onError:()=>f(!0)})}):F?e.jsxs("div",{className:"w-full h-32 rounded-xl overflow-hidden bg-gray-900 relative flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-white ml-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})}),e.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center ${m.video}`,children:b("video")})]}):e.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center ${m[t.icon_type]} transition-transform duration-200 group-hover:scale-110`,children:b(t.icon_type)})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[e.jsx("p",{className:"text-sm font-medium text-text-primary truncate max-w-[140px]",title:t.name,children:t.name}),t.is_shared&&e.jsx(oe,{size:"sm"})]}),e.jsx("p",{className:"text-xs text-text-secondary mt-1.5",children:t.formatted_size})]})]})}function we({folder:t,onOpen:l,onContextMenu:n}){return e.jsxs("div",{className:"group relative bg-card border border-border rounded-2xl p-4 transition-all duration-200 cursor-pointer card-hover hover:border-primary/40 hover:shadow-lg",onClick:l,onContextMenu:a=>{a.preventDefault(),n(a,t)},children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center bg-gradient-to-br from-primary-light to-blue-100 text-primary transition-transform duration-200 group-hover:scale-110",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-sm font-medium text-text-primary truncate max-w-[140px] mx-auto",title:t.name,children:t.name})}),e.jsx("button",{className:"absolute top-3 right-3 p-1.5 rounded-xl opacity-0 group-hover:opacity-100 hover:bg-gray-100 transition-all duration-200",onClick:a=>{a.stopPropagation(),n(a,t)},children:e.jsx("svg",{className:"w-5 h-5 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})]})}function ke({files:t,folders:l,selectedFiles:n,onSelectFile:a,onContextMenu:c,onOpenFolder:h,onFolderContextMenu:u,onPreview:w,onDownload:f,onShare:i}){return t.length===0&&l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-50 rounded-3xl flex items-center justify-center mb-6",children:e.jsx("svg",{className:"w-12 h-12 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"No files yet"}),e.jsx("p",{className:"text-text-secondary",children:"Upload files to get started"})]}):e.jsxs("div",{className:"space-y-6",children:[l.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Folders"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:l.map(r=>e.jsx(we,{folder:r,onOpen:()=>h(r.id),onContextMenu:u},r.id))})]}),t.length>0&&e.jsxs("div",{children:[l.length>0&&e.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Files"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:t.map(r=>e.jsx(be,{file:r,selected:n.includes(r.id),onSelect:a,onContextMenu:c,onPreview:w,onDownload:f,onShare:i},r.id))})]})]})}function Ne({files:t,folders:l,selectedFiles:n,onSelectFile:a,onContextMenu:c,onOpenFolder:h,onFolderContextMenu:u,sortBy:w,sortOrder:f,onSort:i}){const r=m=>{i(m)},o=m=>m!==w?null:e.jsx("svg",{className:`w-4 h-4 inline ml-1 transition-transform ${f==="desc"?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),b=m=>new Date(m).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return t.length===0&&l.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-50 rounded-3xl flex items-center justify-center mb-6",children:e.jsx("svg",{className:"w-12 h-12 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"No files yet"}),e.jsx("p",{className:"text-text-secondary",children:"Upload files to get started"})]}):e.jsx("div",{className:"bg-card border border-border rounded-2xl overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50/80 border-b border-border",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10 px-4 py-4",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded-md border-border cursor-pointer",checked:n.length===t.length&&t.length>0,onChange:()=>{n.length===t.length?a(null,!0):t.forEach(m=>a(m.id))}})}),e.jsxs("th",{className:"px-4 py-4 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider cursor-pointer hover:text-text-primary transition-colors",onClick:()=>r("name"),children:["Name ",o("name")]}),e.jsxs("th",{className:"px-4 py-4 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider cursor-pointer hover:text-text-primary transition-colors hidden sm:table-cell",onClick:()=>r("created_at"),children:["Date ",o("created_at")]}),e.jsxs("th",{className:"px-4 py-4 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider cursor-pointer hover:text-text-primary transition-colors hidden md:table-cell",onClick:()=>r("size"),children:["Size ",o("size")]}),e.jsx("th",{className:"w-10 px-4 py-4"})]})}),e.jsxs("tbody",{className:"divide-y divide-border/60",children:[l.map(m=>e.jsxs("tr",{className:"hover:bg-gray-50/60 cursor-pointer transition-colors",onClick:()=>h(m.id),onContextMenu:j=>{j.preventDefault(),u(j,m)},children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"w-5"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-gradient-to-br from-primary-light to-blue-100 flex items-center justify-center shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),e.jsx("span",{className:"font-medium text-text-primary",children:m.name})]})}),e.jsx("td",{className:"px-4 py-4 text-sm text-text-secondary hidden sm:table-cell",children:b(m.created_at)}),e.jsx("td",{className:"px-4 py-4 text-sm text-text-secondary hidden md:table-cell",children:"â€”"}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("button",{onClick:j=>{j.stopPropagation(),u(j,m)},className:"p-1.5 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]},`folder-${m.id}`)),t.map(m=>e.jsxs("tr",{className:`hover:bg-gray-50/60 transition-colors ${n.includes(m.id)?"bg-primary-light/30":""}`,onContextMenu:j=>{j.preventDefault(),c(j,m)},children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded-md border-border cursor-pointer",checked:n.includes(m.id),onChange:()=>a(m.id)})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-gray-100 flex items-center justify-center shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-text-primary truncate",children:m.name}),m.is_shared&&e.jsx(oe,{size:"sm"})]}),e.jsx("p",{className:"text-xs text-text-secondary uppercase",children:m.extension})]})]})}),e.jsx("td",{className:"px-4 py-4 text-sm text-text-secondary hidden sm:table-cell",children:b(m.created_at)}),e.jsx("td",{className:"px-4 py-4 text-sm text-text-secondary hidden md:table-cell",children:m.formatted_size}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("button",{onClick:j=>{j.stopPropagation(),c(j,m)},className:"p-1.5 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]},`file-${m.id}`))]})]})})}function Ce({files:t,uploadStates:l,onRemove:n,onCancel:a,onRetry:c,formatFileSize:h}){const u=i=>{switch(i){case"completed":return"text-green-600";case"error":return"text-red-600";case"cancelled":return"text-gray-500";case"processing":return"text-blue-600";default:return"text-primary"}},w=i=>{switch(i){case"initializing":return"Initializing...";case"uploading":return"Uploading...";case"processing":return"Processing...";case"completed":return"Completed";case"error":return"Failed";case"cancelled":return"Cancelled";default:return"Pending"}},f=i=>{switch(i){case"completed":return"bg-green-500";case"error":return"bg-red-500";case"cancelled":return"bg-gray-400";case"processing":return"bg-blue-500";default:return"bg-primary"}};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-text-primary",children:[t.length," file(s) selected"]}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-3",children:t.map((i,r)=>{const o=l[r]||{status:"pending",progress:0},b=["initializing","uploading","processing"].includes(o.status);return e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${o.status==="completed"?"bg-green-100":o.status==="error"?"bg-red-100":"bg-primary-light"}`,children:o.status==="completed"?e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):o.status==="error"?e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}):b?e.jsxs("svg",{className:"w-5 h-5 text-primary animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"w-5 h-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-text-primary truncate",children:i.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:h(i.size)}),e.jsx("span",{className:`${u(o.status)}`,children:w(o.status)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[o.status==="error"&&e.jsx("button",{onClick:()=>c(r),className:"p-1.5 text-primary hover:bg-primary-light rounded-lg transition-colors",title:"Retry",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),b&&e.jsx("button",{onClick:()=>a(r),className:"p-1.5 text-text-secondary hover:text-error hover:bg-red-50 rounded-lg transition-colors",title:"Cancel",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),!b&&e.jsx("button",{onClick:()=>n(r),className:"p-1.5 text-text-secondary hover:text-error hover:bg-red-50 rounded-lg transition-colors",title:"Remove",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),(b||o.status==="completed")&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:o.status==="processing"?"Processing on server...":o.status==="completed"?"Upload complete":`Uploading chunk ${o.uploadedChunks||0} of ${o.totalChunks||"?"}`}),e.jsxs("span",{className:"text-text-primary font-medium",children:[Math.round(o.progress||0),"%"]})]}),e.jsx("div",{className:"h-1.5 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 ${f(o.status)} ${o.status==="processing"?"animate-pulse":""}`,style:{width:`${o.progress||0}%`}})})]}),o.status==="error"&&o.error&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:o.error})]},`${i.name}-${r}`)})})]})}const Le=3;function Me({folderId:t,onClose:l,onUploadComplete:n}){const[a,c]=s.useState([]),[h,u]=s.useState({}),[w,f]=s.useState(!1),[i,r]=s.useState(!1),o=s.useRef(null),b=s.useRef({});s.useEffect(()=>()=>{Object.values(b.current).forEach(d=>{d?.abort()})},[]);const m=s.useCallback(d=>{d.preventDefault(),f(!0)},[]),j=s.useCallback(d=>{d.preventDefault(),f(!1)},[]),F=s.useCallback(d=>{d.preventDefault(),f(!1);const g=Array.from(d.dataTransfer.files);D(g)},[]),R=d=>{const g=Array.from(d.target.files);D(g),d.target.value=""},D=d=>{c(g=>{const v=new Set(g.map(C=>C.name)),N=d.filter(C=>!v.has(C.name));return[...g,...N]})},A=d=>{a[d],h[d]?.sessionId&&L(d),c(g=>g.filter((v,N)=>N!==d)),u(g=>{const v={...g};return delete v[d],v})},y=d=>{if(d===0)return"0 B";const g=1024,v=["B","KB","MB","GB","TB"],N=Math.floor(Math.log(d)/Math.log(g));return parseFloat((d/Math.pow(g,N)).toFixed(2))+" "+v[N]},E=async(d,g)=>{try{b.current[g]=new AbortController,u(z=>({...z,[g]:{status:"initializing",progress:0,error:null}}));const v=await q.post("/api/uploads/initiate",{filename:d.name,file_size:d.size,folder_id:t},{signal:b.current[g]?.signal}),{session_id:N,chunk_size:C,total_chunks:S}=v.data;u(z=>({...z,[g]:{sessionId:N,status:"uploading",progress:0,uploadedChunks:[],totalChunks:S,chunkSize:C,error:null}})),await P(d,g,N,C,S)}catch(v){if(q.isCancel(v))return;u(N=>({...N,[g]:{...N[g],status:"error",error:v.response?.data?.message||v.response?.data?.errors?.[0]||"Failed to initialize upload"}}))}},P=async(d,g,v,N,C)=>{const S=[];for(let W=0;W<C;W++){const V=W*N,K=Math.min(V+N,d.size);S.push({index:W,start:V,end:K})}const z=[...S],_=new Set,X=async()=>{for(;z.length>0||_.size>0;){if(b.current[g]?.signal?.aborted)return;for(;_.size<Le&&z.length>0;){const W=z.shift(),V=k(d,g,v,W).catch(K=>{if(!q.isCancel(K))if(!W.retries||W.retries<3)W.retries=(W.retries||0)+1,z.push(W);else throw K}).finally(()=>{_.delete(V)});_.add(V)}_.size>0&&await Promise.race(_)}};try{await X()}catch(W){q.isCancel(W)||u(V=>({...V,[g]:{...V[g],status:"error",error:W.response?.data?.message||"Upload failed"}}))}},k=async(d,g,v,N)=>{const C=d.slice(N.start,N.end),S=new FormData;S.append("chunk",C),S.append("chunk_index",N.index);const z=await q.post(`/api/uploads/${v}/chunk`,S,{headers:{"Content-Type":"multipart/form-data"},signal:b.current[g]?.signal});return u(_=>{const X=_[g];if(!X)return _;const W=z.data.status==="assembling"?"processing":z.data.status==="completed"?"completed":"uploading";return{..._,[g]:{...X,progress:z.data.progress,uploadedChunks:z.data.uploaded_chunks,status:W}}}),z.data.status==="completed"&&n?.(),z.data},L=async d=>{const g=h[d];if(g?.sessionId){b.current[d]?.abort();try{await q.delete(`/api/uploads/${g.sessionId}`)}catch{}u(v=>({...v,[d]:{...v[d],status:"cancelled"}}))}},p=async d=>{const g=a[d];g&&(b.current[d]=new AbortController,u(v=>({...v,[d]:{status:"initializing",progress:0,error:null}})),await E(g,d))},M=async()=>{if(a.length===0||i)return;r(!0);const d=a.map((g,v)=>{const N=h[v];return N?.status==="completed"||N?.status==="uploading"||N?.status==="processing"?Promise.resolve():E(g,v)});await Promise.allSettled(d),r(!1)},$=a.length>0&&a.every((d,g)=>h[g]?.status==="completed");Object.values(h).some(d=>d?.status==="error");const O=Object.values(h).some(d=>d?.status==="uploading"||d?.status==="processing"||d?.status==="initializing");return e.jsxs("div",{className:"space-y-4",children:[!i&&!O&&e.jsxs("div",{onDragOver:m,onDragLeave:j,onDrop:F,onClick:()=>o.current?.click(),className:`border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all ${w?"border-primary bg-primary-light dropzone-active":"border-border hover:border-primary hover:bg-gray-50"}`,children:[e.jsx("input",{ref:o,type:"file",multiple:!0,onChange:R,className:"hidden"}),e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center ${w?"bg-primary text-white":"bg-primary-light text-primary"}`,children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-text-primary font-medium",children:w?"Drop files here":"Drag & drop files here"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"or click to browse"})]}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Maximum file size: 10GB (large files upload in chunks)"})]})]}),a.length>0&&e.jsx(Ce,{files:a,uploadStates:h,onRemove:A,onCancel:L,onRetry:p,formatFileSize:y}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-border",children:[e.jsx(B,{variant:"ghost",onClick:l,children:$?"Close":"Cancel"}),!$&&e.jsx(B,{onClick:M,disabled:a.length===0||O,loading:O,children:O?"Uploading...":`Upload ${a.length>0?`(${a.length})`:""}`}),$&&e.jsx(B,{onClick:()=>{n?.(),l?.()},children:"Done"})]})]})}const Z=100*1024*1024;function Se({folderId:t,onClose:l}){const[n,a]=s.useState([]),[c,h]=s.useState(!1),[u,w]=s.useState(!1),[f,i]=s.useState({}),[r,o]=s.useState(!1),b=s.useRef(null),m=s.useCallback(k=>{k.preventDefault(),h(!0)},[]),j=s.useCallback(k=>{k.preventDefault(),h(!1)},[]),F=s.useCallback(k=>{k.preventDefault(),h(!1);const L=Array.from(k.dataTransfer.files);D(L)},[]),R=k=>{const L=Array.from(k.target.files);D(L),k.target.value=""},D=k=>{k.some(p=>p.size>Z)?(o(!0),a(p=>[...p,...k])):a(p=>[...p,...k])},A=k=>{a(L=>{const p=L.filter((M,$)=>$!==k);return p.some(M=>M.size>Z)||o(!1),p})},y=k=>{if(k===0)return"0 B";const L=1024,p=["B","KB","MB","GB","TB"],M=Math.floor(Math.log(k)/Math.log(L));return parseFloat((k/Math.pow(L,M)).toFixed(2))+" "+p[M]},E=()=>{if(n.length===0)return;w(!0);const k=new FormData;n.forEach(L=>{k.append("files[]",L)}),t&&k.append("folder_id",t),H.post("/files/upload",k,{forceFormData:!0,onProgress:L=>{i({percentage:L.percentage})},onSuccess:()=>{a([]),w(!1),l?.()},onError:()=>{w(!1)}})},P=()=>{H.reload({only:["files","stats"]})};return r||n.some(k=>k.size>Z)?e.jsx(Me,{folderId:t,onClose:()=>{a([]),o(!1),l?.()},onUploadComplete:P}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{onDragOver:m,onDragLeave:j,onDrop:F,onClick:()=>b.current?.click(),className:`border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all ${c?"border-primary bg-primary-light dropzone-active":"border-border hover:border-primary hover:bg-gray-50"}`,children:[e.jsx("input",{ref:b,type:"file",multiple:!0,onChange:R,className:"hidden"}),e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center ${c?"bg-primary text-white":"bg-primary-light text-primary"}`,children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-text-primary font-medium",children:c?"Drop files here":"Drag & drop files here"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"or click to browse"})]}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Files up to 10GB supported (large files use chunked upload)"})]})]}),n.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-text-primary",children:[n.length," file(s) selected"]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:n.map((k,L)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-light rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-text-primary truncate",children:k.name}),e.jsx("p",{className:"text-xs text-text-secondary",children:y(k.size)})]})]}),!u&&e.jsx("button",{onClick:()=>A(L),className:"p-1 text-text-secondary hover:text-error transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},L))})]}),u&&f.percentage!==void 0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-text-secondary",children:"Uploading..."}),e.jsxs("span",{className:"text-text-primary font-medium",children:[Math.round(f.percentage),"%"]})]}),e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${f.percentage}%`}})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-border",children:[e.jsx(B,{variant:"ghost",onClick:l,children:"Cancel"}),e.jsxs(B,{onClick:E,disabled:n.length===0,loading:u,children:["Upload ",n.length>0&&`(${n.length})`]})]})]})}function ze({x:t,y:l,file:n,onClose:a,onDownload:c,onRename:h,onDelete:u,onMove:w,onShare:f}){const i=s.useRef(null);return s.useEffect(()=>{const r=b=>{i.current&&!i.current.contains(b.target)&&a()},o=b=>{b.key==="Escape"&&a()};return document.addEventListener("mousedown",r),document.addEventListener("keydown",o),()=>{document.removeEventListener("mousedown",r),document.removeEventListener("keydown",o)}},[a]),s.useEffect(()=>{if(i.current){const r=i.current.getBoundingClientRect(),o=window.innerWidth,b=window.innerHeight;r.right>o&&(i.current.style.left=`${t-r.width}px`),r.bottom>b&&(i.current.style.top=`${l-r.height}px`)}},[t,l]),e.jsxs("div",{ref:i,className:"fixed z-50 bg-card rounded-lg shadow-lg border border-border py-1 min-w-[180px]",style:{left:t,top:l},children:[e.jsxs("button",{onClick:()=>{c(n),a()},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]}),e.jsxs("button",{onClick:()=>{f(n),a()},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Share"]}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsxs("button",{onClick:()=>{h(n),a()},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Rename"]}),e.jsxs("button",{onClick:()=>{w(n),a()},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),"Move to..."]}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsxs("button",{onClick:()=>{u(n),a()},className:"w-full px-4 py-2 text-left text-sm text-error hover:bg-red-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})}const ee=()=>{const t=document.querySelector('meta[name="csrf-token"]');return t?t.getAttribute("content"):""};function De({isOpen:t,onClose:l,file:n,existingShare:a}){const[c,h]=s.useState("public"),[u,w]=s.useState(""),[f,i]=s.useState(""),[r,o]=s.useState(""),[b,m]=s.useState(!1),[j,F]=s.useState(a||null),[R,D]=s.useState(!1),[A,y]=s.useState("");s.useEffect(()=>{a?(F(a),h(a.share_type),i(a.expires_at?a.expires_at.slice(0,16):""),o(a.max_downloads?.toString()||"")):(F(null),h("public"),w(""),i(""),o("")),y("")},[a,t]);const E=async p=>{p.preventDefault(),m(!0),y("");try{const M=await fetch(`/shares/files/${n.id}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":ee()},body:JSON.stringify({share_type:c,password:c==="password"?u:null,expires_at:f||null,max_downloads:r?parseInt(r):null})}),$=await M.json();if(!M.ok)throw new Error($.message||"Failed to create share link");F($.share)}catch(M){y(M.message)}finally{m(!1)}},P=async()=>{if(j){m(!0),y("");try{const p=await fetch(`/shares/${j.id}`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":ee()},body:JSON.stringify({share_type:c,password:c==="password"&&u?u:null,expires_at:f||null,max_downloads:r?parseInt(r):null})}),M=await p.json();if(!p.ok)throw new Error(M.message||"Failed to update share");F(M.share)}catch(p){y(p.message)}finally{m(!1)}}},k=async()=>{if(j){m(!0),y("");try{const p=await fetch(`/shares/${j.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":ee()}});if(!p.ok){const M=await p.json();throw new Error(M.message||"Failed to revoke share")}F(null),h("public"),w(""),i(""),o("")}catch(p){y(p.message)}finally{m(!1)}}},L=async()=>{if(j?.share_url)try{await navigator.clipboard.writeText(j.share_url),D(!0),setTimeout(()=>D(!1),2e3)}catch{const p=document.createElement("textarea");p.value=j.share_url,document.body.appendChild(p),p.select(),document.execCommand("copy"),document.body.removeChild(p),D(!0),setTimeout(()=>D(!1),2e3)}};return e.jsx(G,{isOpen:t,onClose:l,title:`Share "${n?.name}"`,size:"md",children:e.jsxs("div",{className:"space-y-6",children:[A&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-xl text-sm text-error",children:A}),j?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Share Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:j.share_url,className:"flex-1 px-4 py-2.5 border border-border rounded-xl bg-gray-50 text-text-primary text-sm"}),e.jsx(B,{variant:R?"secondary":"primary",onClick:L,children:R?e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-text-secondary uppercase tracking-wider",children:"Downloads"}),e.jsxs("p",{className:"text-2xl font-semibold text-text-primary mt-1",children:[j.access_count,j.max_downloads&&e.jsxs("span",{className:"text-sm font-normal text-text-secondary",children:[" / ",j.max_downloads]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-text-secondary uppercase tracking-wider",children:"Expires"}),e.jsx("p",{className:"text-lg font-semibold text-text-primary mt-1",children:j.expires_at?new Date(j.expires_at).toLocaleDateString():"Never"})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-border",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary",children:"Update Settings"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm text-text-secondary",children:"Access Type"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"shareType",value:"public",checked:c==="public",onChange:p=>h(p.target.value),className:"text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-text-primary",children:"Public"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"shareType",value:"password",checked:c==="password",onChange:p=>h(p.target.value),className:"text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-text-primary",children:"Password Protected"})]})]})]}),c==="password"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm text-text-secondary",children:["New Password ",j.share_type==="password"&&"(leave blank to keep current)"]}),e.jsx("input",{type:"password",value:u,onChange:p=>w(p.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter password"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm text-text-secondary",children:"Expires At"}),e.jsx("input",{type:"datetime-local",value:f,onChange:p=>i(p.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm text-text-secondary",children:"Max Downloads"}),e.jsx("input",{type:"number",value:r,onChange:p=>o(p.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Unlimited",min:"1"})]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(B,{variant:"danger",onClick:k,loading:b,children:"Revoke Link"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(B,{variant:"ghost",onClick:l,children:"Close"}),e.jsx(B,{onClick:P,loading:b,children:"Update"})]})]})]}):e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Access Type"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>h("public"),className:`p-4 rounded-xl border-2 text-left transition-all ${c==="public"?"border-primary bg-primary-light":"border-border hover:border-primary/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${c==="public"?"bg-primary text-white":"bg-gray-100 text-text-secondary"}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("span",{className:"font-medium text-text-primary",children:"Public"})]}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Anyone with the link can download"})]}),e.jsxs("button",{type:"button",onClick:()=>h("password"),className:`p-4 rounded-xl border-2 text-left transition-all ${c==="password"?"border-primary bg-primary-light":"border-border hover:border-primary/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${c==="password"?"bg-primary text-white":"bg-gray-100 text-text-secondary"}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("span",{className:"font-medium text-text-primary",children:"Password"})]}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Requires password to download"})]})]})]}),c==="password"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Password"}),e.jsx("input",{type:"password",value:u,onChange:p=>w(p.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter a secure password",required:c==="password",minLength:4})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Expires At"}),e.jsx("input",{type:"datetime-local",value:f,onChange:p=>i(p.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Leave empty for no expiration"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Max Downloads"}),e.jsx("input",{type:"number",value:r,onChange:p=>o(p.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Unlimited",min:"1"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Leave empty for unlimited"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(B,{type:"button",variant:"ghost",onClick:l,children:"Cancel"}),e.jsx(B,{type:"submit",loading:b,children:"Create Share Link"})]})]})]})})}function Fe({file:t,onClose:l,onDownload:n,onShare:a}){const[c,h]=s.useState(!0),[u,w]=s.useState(!1);if(s.useEffect(()=>{const b=m=>{m.key==="Escape"&&l()};return document.addEventListener("keydown",b),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",b),document.body.style.overflow="unset"}},[l]),!t)return null;const f=t.icon_type==="image",i=t.icon_type==="video",r=()=>{h(!1)},o=()=>{h(!1),w(!0)};return me.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/90 backdrop-blur-sm fade-in",onClick:l}),e.jsx("button",{onClick:l,className:"absolute top-4 right-4 z-10 p-2 rounded-xl bg-white/10 text-white hover:bg-white/20 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-3",children:e.jsxs("div",{className:"px-4 py-2 rounded-xl bg-white/10 backdrop-blur-sm",children:[e.jsx("p",{className:"text-white font-medium truncate max-w-md",children:t.name}),e.jsx("p",{className:"text-white/60 text-sm",children:t.formatted_size})]})}),e.jsxs("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 z-10 flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>n(t),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/10 text-white hover:bg-white/20 transition-colors backdrop-blur-sm",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]}),a&&e.jsxs("button",{onClick:()=>{l(),a(t)},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/10 text-white hover:bg-white/20 transition-colors backdrop-blur-sm",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Share"]})]}),e.jsxs("div",{className:"relative max-w-[90vw] max-h-[85vh] modal-enter",children:[c&&!u&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 border-4 border-white/20 border-t-white rounded-full animate-spin"})}),u&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-white/10 rounded-2xl flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-white/60",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("p",{className:"text-white font-medium mb-1",children:"Unable to load preview"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Download the file to view it"})]}),f&&e.jsx("img",{src:`/files/${t.id}/download`,alt:t.name,className:`max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl ${c?"opacity-0":"opacity-100"} transition-opacity duration-300`,onLoad:r,onError:o}),i&&e.jsx("video",{src:`/files/${t.id}/download`,controls:!0,autoPlay:!0,className:`max-w-full max-h-[85vh] rounded-lg shadow-2xl ${c?"opacity-0":"opacity-100"} transition-opacity duration-300`,onLoadedData:r,onError:o})]})]}),document.body)}function Be(t="created_at",l="desc"){const[n,a]=s.useState(t),[c,h]=s.useState(l),u=[{value:"name",label:"Name"},{value:"created_at",label:"Date uploaded"},{value:"size",label:"Size"},{value:"extension",label:"Type"}],w=s.useCallback(i=>{let r="asc";i===n?r=c==="asc"?"desc":"asc":r=i==="created_at"||i==="size"?"desc":"asc",a(i),h(r),H.get(window.location.pathname,{...Object.fromEntries(new URLSearchParams(window.location.search)),sort_by:i,sort_order:r},{preserveState:!0,preserveScroll:!0})},[n,c]),f=s.useCallback(i=>i!==n?null:c==="asc"?"â†‘":"â†“",[n,c]);return{sortBy:n,sortOrder:c,sortOptions:u,handleSort:w,getSortIcon:f}}function Re({files:t,folders:l,currentFolder:n,breadcrumbs:a,filters:c,stats:h}){const[u,w]=s.useState("grid"),[f,i]=s.useState([]),[r,o]=s.useState(!1),[b,m]=s.useState(!1),[j,F]=s.useState(!1),[R,D]=s.useState(!1),[A,y]=s.useState(!1),[E,P]=s.useState(null),[k,L]=s.useState(null),[p,M]=s.useState(null),[$,O]=s.useState(null),[d,g]=s.useState(null),[v,N]=s.useState(null),[C,S]=s.useState(""),[z,_]=s.useState(""),{sortBy:X,sortOrder:W,handleSort:V}=Be(c.sort_by||"created_at",c.sort_order||"desc"),K=s.useCallback((x,U=!1)=>{if(U){i([]);return}i(T=>T.includes(x)?T.filter(ne=>ne!==x):[...T,x])},[]),te=s.useCallback((x,U)=>{x.preventDefault(),O({x:x.clientX,y:x.clientY}),N(U)},[]),se=s.useCallback((x,U)=>{x.preventDefault(),g({x:x.clientX,y:x.clientY}),N(U)},[]),I=x=>{H.get("/files",{folder_id:x})},J=x=>{window.location.href=`/files/${x.id}/download`},le=x=>{M(x)},re=x=>{N(x),_(x.name),F(!0)},ae=x=>{N(x),D(!0)},ie=x=>{H.patch(`/files/${x.id}/move`,{folder_id:null})},Q=async x=>{P(x),L(null);try{const T=await(await fetch(`/shares/files/${x.id}`,{headers:{Accept:"application/json"}})).json();T.share&&L(T.share)}catch{}y(!0)},ce=x=>{x.preventDefault(),H.post("/folders",{name:C,parent_id:n?.id||null},{onSuccess:()=>{m(!1),S("")}})},de=x=>{x.preventDefault();const U=!v.extension,T=U?`/folders/${v.id}`:`/files/${v.id}/rename`;H["patch"](T,{name:z},{onSuccess:()=>{F(!1),N(null),_("")}})},ue=()=>{const U=!v.extension?`/folders/${v.id}`:`/files/${v.id}`;H.delete(U,{onSuccess:()=>{D(!1),N(null)}})},xe=()=>{f.length!==0&&H.post("/files/bulk-delete",{file_ids:f},{onSuccess:()=>i([])})},he=x=>{H.get("/files",{...Object.fromEntries(new URLSearchParams(window.location.search)),folder_id:n?.id,type:x==="all"?void 0:x},{preserveState:!0})};return e.jsxs(ge,{title:"My Files",children:[e.jsx(pe,{title:"My Files"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(B,{onClick:()=>o(!0),children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Upload"]}),e.jsxs(B,{variant:"secondary",onClick:()=>m(!0),children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),"New Folder"]}),f.length>0&&e.jsxs(B,{variant:"danger",onClick:xe,children:["Delete (",f.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[e.jsx("div",{className:"flex-1 sm:w-72",children:e.jsx(ye,{initialValue:c.search||""})}),e.jsxs("div",{className:"flex items-center border border-border rounded-lg",children:[e.jsx("button",{onClick:()=>w("grid"),className:`p-2 ${u==="grid"?"bg-primary-light text-primary":"text-text-secondary hover:bg-gray-50"}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsx("button",{onClick:()=>w("list"),className:`p-2 ${u==="list"?"bg-primary-light text-primary":"text-text-secondary hover:bg-gray-50"}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Y,{href:"/files",className:"text-primary hover:text-primary-hover font-medium",children:"My Files"}),a.map((x,U)=>e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),U===a.length-1?e.jsx("span",{className:"text-text-primary font-medium",children:x.name}):e.jsx(Y,{href:`/files?folder_id=${x.id}`,className:"text-primary hover:text-primary-hover",children:x.name})]},x.id))]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["all","image","video","audio","document","archive"].map(x=>e.jsx("button",{onClick:()=>he(x),className:`px-3 py-1.5 text-sm rounded-full transition-colors ${(c.type||"all")===x?"bg-primary text-white":"bg-gray-100 text-text-secondary hover:bg-gray-200"}`,children:x.charAt(0).toUpperCase()+x.slice(1)},x))}),e.jsxs("div",{className:"text-sm text-text-secondary",children:[h.file_count," files Â· ",h.total_size," used"]}),u==="grid"?e.jsx(ke,{files:t.data,folders:l,selectedFiles:f,onSelectFile:K,onContextMenu:te,onOpenFolder:I,onFolderContextMenu:se,onPreview:le,onDownload:J,onShare:Q}):e.jsx(Ne,{files:t.data,folders:l,selectedFiles:f,onSelectFile:K,onContextMenu:te,onOpenFolder:I,onFolderContextMenu:se,sortBy:X,sortOrder:W,onSort:V}),t.last_page>1&&e.jsx("div",{className:"flex justify-center gap-2",children:t.links.map((x,U)=>e.jsx(Y,{href:x.url||"#",className:`px-3 py-1 rounded ${x.active?"bg-primary text-white":x.url?"bg-gray-100 text-text-secondary hover:bg-gray-200":"bg-gray-50 text-gray-300 cursor-not-allowed"}`,dangerouslySetInnerHTML:{__html:x.label}},U))})]}),e.jsx(G,{isOpen:r,onClose:()=>o(!1),title:"Upload Files",size:"lg",children:e.jsx(Se,{folderId:n?.id,onClose:()=>o(!1)})}),e.jsx(G,{isOpen:b,onClose:()=>m(!1),title:"Create New Folder",children:e.jsxs("form",{onSubmit:ce,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Folder Name"}),e.jsx("input",{type:"text",value:C,onChange:x=>S(x.target.value),className:"w-full px-4 py-2.5 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter folder name",autoFocus:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(B,{variant:"ghost",onClick:()=>m(!1),children:"Cancel"}),e.jsx(B,{type:"submit",disabled:!C.trim(),children:"Create"})]})]})}),e.jsx(G,{isOpen:j,onClose:()=>F(!1),title:`Rename ${v?.extension?"File":"Folder"}`,children:e.jsxs("form",{onSubmit:de,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"New Name"}),e.jsx("input",{type:"text",value:z,onChange:x=>_(x.target.value),className:"w-full px-4 py-2.5 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",autoFocus:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(B,{variant:"ghost",onClick:()=>F(!1),children:"Cancel"}),e.jsx(B,{type:"submit",disabled:!z.trim(),children:"Rename"})]})]})}),e.jsx(G,{isOpen:R,onClose:()=>D(!1),title:`Delete ${v?.extension?"File":"Folder"}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-text-secondary",children:["Are you sure you want to delete ",e.jsx("strong",{children:v?.name}),"?",!v?.extension&&" All files inside will also be deleted.","This action cannot be undone."]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(B,{variant:"ghost",onClick:()=>D(!1),children:"Cancel"}),e.jsx(B,{variant:"danger",onClick:ue,children:"Delete"})]})]})}),$&&v&&e.jsx(ze,{x:$.x,y:$.y,file:v,onClose:()=>{O(null),N(null)},onDownload:J,onRename:re,onDelete:ae,onMove:ie,onShare:Q}),e.jsx(De,{isOpen:A,onClose:()=>{y(!1),P(null),L(null)},file:E,existingShare:k}),p&&e.jsx(Fe,{file:p,onClose:()=>M(null),onDownload:J,onShare:Q}),d&&v&&e.jsxs("div",{className:"fixed z-50 bg-card rounded-lg shadow-lg border border-border py-1 min-w-[180px]",style:{left:d.x,top:d.y},children:[e.jsxs("button",{onClick:()=>{I(v.id),g(null)},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),"Open"]}),e.jsxs("button",{onClick:()=>{re(v),g(null)},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Rename"]}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsxs("button",{onClick:()=>{ae(v),g(null)},className:"w-full px-4 py-2 text-left text-sm text-error hover:bg-red-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]}),d&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>{g(null),N(null)}})]})}export{Re as default};
