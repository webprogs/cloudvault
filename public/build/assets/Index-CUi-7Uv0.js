import{r,j as e,a as W,b as ue,H as he,L as X}from"./app-D7WWf1gE.js";import{A as me}from"./AppLayout-BjEqa-Oq.js";import{B as S}from"./Button-CYMjHV4C.js";import{M as T}from"./Modal-BJmsQD6x.js";function pe(t,a,n,o){var i=this,h=r.useRef(null),u=r.useRef(0),j=r.useRef(0),m=r.useRef(null),x=r.useRef([]),s=r.useRef(),p=r.useRef(),y=r.useRef(t),d=r.useRef(!0),f=r.useRef(),N=r.useRef();y.current=t;var F=typeof window<"u",C=!a&&a!==0&&F;if(typeof t!="function")throw new TypeError("Expected a function");a=+a||0;var v=!!(n=n||{}).leading,c=!("trailing"in n)||!!n.trailing,w=!!n.flushOnExit&&c,z="maxWait"in n,A="debounceOnServer"in n&&!!n.debounceOnServer,R=z?Math.max(+n.maxWait||0,a):null,g=r.useMemo(function(){var k=function(b){var M=x.current,_=s.current;return x.current=s.current=null,u.current=b,j.current=j.current||b,p.current=y.current.apply(_,M)},B=function(b,M){C&&cancelAnimationFrame(m.current),m.current=C?requestAnimationFrame(b):setTimeout(b,M)},P=function(b){if(!d.current)return!1;var M=b-h.current;return!h.current||M>=a||M<0||z&&b-u.current>=R},O=function(b){return m.current=null,c&&x.current?k(b):(x.current=s.current=null,p.current)},$=function b(){var M=Date.now();if(v&&j.current===u.current&&L(),P(M))return O(M);if(d.current){var _=a-(M-h.current),V=z?Math.min(_,R-(M-u.current)):_;B(b,V)}},L=function(){},E=function(){if(F||A){var b,M=Date.now(),_=P(M);if(x.current=[].slice.call(arguments),s.current=i,h.current=M,w&&!f.current&&(f.current=function(){var V;((V=global.document)==null?void 0:V.visibilityState)==="hidden"&&N.current.flush()},(b=global.document)==null||b.addEventListener==null||b.addEventListener("visibilitychange",f.current)),_){if(!m.current&&d.current)return u.current=h.current,B($,a),v?k(h.current):p.current;if(z)return B($,a),k(h.current)}return m.current||B($,a),p.current}};return E.cancel=function(){var b=m.current;b&&(C?cancelAnimationFrame(m.current):clearTimeout(m.current)),u.current=0,x.current=h.current=s.current=m.current=null},E.isPending=function(){return!!m.current},E.flush=function(){return m.current?O(Date.now()):p.current},E},[v,z,a,R,c,w,C,F,A,o]);return N.current=g,r.useEffect(function(){return d.current=!0,function(){var k;w&&N.current.flush(),f.current&&((k=global.document)==null||k.removeEventListener==null||k.removeEventListener("visibilitychange",f.current),f.current=null),d.current=!1}},[w]),g}function fe(t){const[a,n]=r.useState(!1),[o,i]=r.useState(!1),[h,u]=r.useState(null);r.useEffect(()=>{const x=window.SpeechRecognition||window.webkitSpeechRecognition;i(!!x)},[]);const j=r.useCallback(()=>{if(!o){u("Voice search is not supported in this browser");return}const x=window.SpeechRecognition||window.webkitSpeechRecognition,s=new x;s.continuous=!1,s.interimResults=!1,s.lang="en-US",s.onstart=()=>{n(!0),u(null)},s.onresult=p=>{const y=p.results[0][0].transcript;t(y),n(!1)},s.onerror=p=>{u(p.error==="not-allowed"?"Microphone access denied":"Voice search error: "+p.error),n(!1)},s.onend=()=>{n(!1)};try{s.start()}catch{u("Failed to start voice search"),n(!1)}},[o,t]),m=r.useCallback(()=>{n(!1)},[]);return{isListening:a,isSupported:o,error:h,startListening:j,stopListening:m}}function ge({onResult:t}){const{isListening:a,isSupported:n,error:o,startListening:i}=fe(t);return n?e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:i,disabled:a,className:`p-1.5 rounded-md transition-colors ${a?"text-primary bg-primary-light":"text-text-secondary hover:text-text-primary hover:bg-gray-100"}`,title:a?"Listening...":"Voice search",children:e.jsxs("div",{className:"relative",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})}),a&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-error rounded-full voice-active"})]})}),o&&e.jsx("div",{className:"absolute top-full right-0 mt-2 px-3 py-2 bg-error text-white text-xs rounded-lg whitespace-nowrap z-10",children:o})]}):null}function ve({initialValue:t="",placeholder:a="Search files..."}){const[n,o]=r.useState(t),[i,h]=r.useState(!1),u=pe(s=>{W.get(window.location.pathname,{...Object.fromEntries(new URLSearchParams(window.location.search)),search:s||void 0},{preserveState:!0,preserveScroll:!0})},300),j=s=>{const p=s.target.value;o(p),u(p)},m=r.useCallback(s=>{o(s),u(s)},[u]),x=()=>{o(""),u("")};return e.jsx("div",{className:"relative flex items-center",children:e.jsxs("div",{className:`relative flex-1 transition-all duration-200 ${i?"scale-[1.02]":""}`,children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx("svg",{className:`h-5 w-5 transition-colors ${i?"text-primary":"text-text-secondary"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:n,onChange:j,onFocus:()=>h(!0),onBlur:()=>h(!1),placeholder:a,className:`block w-full pl-12 pr-24 py-3 border rounded-xl bg-card text-text-primary placeholder-text-secondary transition-all duration-200 ${i?"border-primary ring-4 ring-primary/10 shadow-lg":"border-border hover:border-gray-300 shadow-sm"}`}),e.jsxs("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 gap-1",children:[n&&e.jsx("button",{onClick:x,className:"p-2 rounded-lg text-text-secondary hover:text-text-primary hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx(ge,{onResult:m})]})]})})}function te({size:t="sm"}){const a={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"};return e.jsx("div",{className:"inline-flex items-center justify-center text-primary",title:"This file is shared",children:e.jsx("svg",{className:a[t],fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})})}function je({file:t,selected:a,onSelect:n,onContextMenu:o,onPreview:i,onDownload:h,onShare:u}){const[j,m]=r.useState(!1),[x,s]=r.useState(!1),p=r.useRef(null);r.useEffect(()=>{const c=w=>{p.current&&!p.current.contains(w.target)&&s(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[]);const y=c=>{const w={image:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),video:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),audio:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),document:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),archive:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),file:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})};return w[c]||w.file},d={image:"text-green-500 bg-green-50",video:"text-purple-500 bg-purple-50",audio:"text-pink-500 bg-pink-50",document:"text-blue-500 bg-blue-50",archive:"text-yellow-500 bg-yellow-50",file:"text-gray-500 bg-gray-50"},f=t.icon_type==="image",N=t.icon_type==="video",F=f||N,C=c=>{c.ctrlKey||c.metaKey?n(t.id):F&&i&&i(t)},v=()=>{h&&h(t)};return e.jsxs("div",{className:`group relative bg-card border rounded-2xl p-4 transition-all duration-200 cursor-pointer card-hover ${a?"border-primary ring-2 ring-primary/20 shadow-md":"border-border hover:border-primary/40 hover:shadow-lg"}`,onClick:C,onDoubleClick:v,onContextMenu:c=>{c.preventDefault(),o(c,t)},children:[e.jsx("div",{className:`absolute top-3 left-3 w-5 h-5 rounded-lg border-2 flex items-center justify-center transition-all duration-200 z-10 ${a?"bg-primary border-primary shadow-sm":"border-border bg-white opacity-0 group-hover:opacity-100 hover:border-primary/50"}`,onClick:c=>{c.stopPropagation(),n(t.id)},children:a&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"absolute top-3 right-3 z-10",ref:p,children:[e.jsx("button",{className:`p-1.5 rounded-xl transition-all duration-200 ${x?"bg-gray-100 opacity-100":"hover:bg-gray-100 opacity-0 group-hover:opacity-100"}`,onClick:c=>{c.stopPropagation(),s(!x)},children:e.jsx("svg",{className:"w-5 h-5 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),x&&e.jsxs("div",{className:"absolute right-0 mt-1 w-44 bg-card rounded-xl shadow-xl border border-border py-1.5 slide-up",children:[F&&i&&e.jsxs("button",{onClick:c=>{c.stopPropagation(),s(!1),i(t)},className:"w-full px-4 py-2.5 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Preview"]}),e.jsxs("button",{onClick:c=>{c.stopPropagation(),s(!1),h&&h(t)},className:"w-full px-4 py-2.5 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]}),u&&e.jsxs("button",{onClick:c=>{c.stopPropagation(),s(!1),u(t)},className:"w-full px-4 py-2.5 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Share"]}),e.jsx("div",{className:"my-1.5 border-t border-border"}),e.jsxs("button",{onClick:c=>{c.stopPropagation(),s(!1),o(c,t)},className:"w-full px-4 py-2.5 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"More options..."]})]})]}),e.jsx("div",{className:"flex justify-center mb-4 mt-2",children:f&&!j?e.jsx("div",{className:"w-full h-32 rounded-xl overflow-hidden bg-gray-100 relative",children:e.jsx("img",{src:t.thumbnail_url||`/files/${t.id}/download`,alt:t.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",onError:()=>m(!0)})}):N?e.jsxs("div",{className:"w-full h-32 rounded-xl overflow-hidden bg-gray-900 relative flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-white ml-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})}),e.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center ${d.video}`,children:y("video")})]}):e.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center ${d[t.icon_type]} transition-transform duration-200 group-hover:scale-110`,children:y(t.icon_type)})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[e.jsx("p",{className:"text-sm font-medium text-text-primary truncate max-w-[140px]",title:t.name,children:t.name}),t.is_shared&&e.jsx(te,{size:"sm"})]}),e.jsx("p",{className:"text-xs text-text-secondary mt-1.5",children:t.formatted_size})]})]})}function ye({folder:t,onOpen:a,onContextMenu:n}){return e.jsxs("div",{className:"group relative bg-card border border-border rounded-2xl p-4 transition-all duration-200 cursor-pointer card-hover hover:border-primary/40 hover:shadow-lg",onClick:a,onContextMenu:o=>{o.preventDefault(),n(o,t)},children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"w-16 h-16 rounded-2xl flex items-center justify-center bg-gradient-to-br from-primary-light to-blue-100 text-primary transition-transform duration-200 group-hover:scale-110",children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-sm font-medium text-text-primary truncate max-w-[140px] mx-auto",title:t.name,children:t.name})}),e.jsx("button",{className:"absolute top-3 right-3 p-1.5 rounded-xl opacity-0 group-hover:opacity-100 hover:bg-gray-100 transition-all duration-200",onClick:o=>{o.stopPropagation(),n(o,t)},children:e.jsx("svg",{className:"w-5 h-5 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})]})}function be({files:t,folders:a,selectedFiles:n,onSelectFile:o,onContextMenu:i,onOpenFolder:h,onFolderContextMenu:u,onPreview:j,onDownload:m,onShare:x}){return t.length===0&&a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-50 rounded-3xl flex items-center justify-center mb-6",children:e.jsx("svg",{className:"w-12 h-12 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"No files yet"}),e.jsx("p",{className:"text-text-secondary",children:"Upload files to get started"})]}):e.jsxs("div",{className:"space-y-6",children:[a.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Folders"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:a.map(s=>e.jsx(ye,{folder:s,onOpen:()=>h(s.id),onContextMenu:u},s.id))})]}),t.length>0&&e.jsxs("div",{children:[a.length>0&&e.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Files"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:t.map(s=>e.jsx(je,{file:s,selected:n.includes(s.id),onSelect:o,onContextMenu:i,onPreview:j,onDownload:m,onShare:x},s.id))})]})]})}function we({files:t,folders:a,selectedFiles:n,onSelectFile:o,onContextMenu:i,onOpenFolder:h,onFolderContextMenu:u,sortBy:j,sortOrder:m,onSort:x}){const s=d=>{x(d)},p=d=>d!==j?null:e.jsx("svg",{className:`w-4 h-4 inline ml-1 transition-transform ${m==="desc"?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),y=d=>new Date(d).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return t.length===0&&a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-50 rounded-3xl flex items-center justify-center mb-6",children:e.jsx("svg",{className:"w-12 h-12 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"No files yet"}),e.jsx("p",{className:"text-text-secondary",children:"Upload files to get started"})]}):e.jsx("div",{className:"bg-card border border-border rounded-2xl overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50/80 border-b border-border",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10 px-4 py-4",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded-md border-border cursor-pointer",checked:n.length===t.length&&t.length>0,onChange:()=>{n.length===t.length?o(null,!0):t.forEach(d=>o(d.id))}})}),e.jsxs("th",{className:"px-4 py-4 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider cursor-pointer hover:text-text-primary transition-colors",onClick:()=>s("name"),children:["Name ",p("name")]}),e.jsxs("th",{className:"px-4 py-4 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider cursor-pointer hover:text-text-primary transition-colors hidden sm:table-cell",onClick:()=>s("created_at"),children:["Date ",p("created_at")]}),e.jsxs("th",{className:"px-4 py-4 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider cursor-pointer hover:text-text-primary transition-colors hidden md:table-cell",onClick:()=>s("size"),children:["Size ",p("size")]}),e.jsx("th",{className:"w-10 px-4 py-4"})]})}),e.jsxs("tbody",{className:"divide-y divide-border/60",children:[a.map(d=>e.jsxs("tr",{className:"hover:bg-gray-50/60 cursor-pointer transition-colors",onClick:()=>h(d.id),onContextMenu:f=>{f.preventDefault(),u(f,d)},children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"w-5"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-gradient-to-br from-primary-light to-blue-100 flex items-center justify-center shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),e.jsx("span",{className:"font-medium text-text-primary",children:d.name})]})}),e.jsx("td",{className:"px-4 py-4 text-sm text-text-secondary hidden sm:table-cell",children:y(d.created_at)}),e.jsx("td",{className:"px-4 py-4 text-sm text-text-secondary hidden md:table-cell",children:"—"}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("button",{onClick:f=>{f.stopPropagation(),u(f,d)},className:"p-1.5 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]},`folder-${d.id}`)),t.map(d=>e.jsxs("tr",{className:`hover:bg-gray-50/60 transition-colors ${n.includes(d.id)?"bg-primary-light/30":""}`,onContextMenu:f=>{f.preventDefault(),i(f,d)},children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded-md border-border cursor-pointer",checked:n.includes(d.id),onChange:()=>o(d.id)})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-gray-100 flex items-center justify-center shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-text-primary truncate",children:d.name}),d.is_shared&&e.jsx(te,{size:"sm"})]}),e.jsx("p",{className:"text-xs text-text-secondary uppercase",children:d.extension})]})]})}),e.jsx("td",{className:"px-4 py-4 text-sm text-text-secondary hidden sm:table-cell",children:y(d.created_at)}),e.jsx("td",{className:"px-4 py-4 text-sm text-text-secondary hidden md:table-cell",children:d.formatted_size}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("button",{onClick:f=>{f.stopPropagation(),i(f,d)},className:"p-1.5 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]},`file-${d.id}`))]})]})})}function ke({folderId:t,onClose:a}){const[n,o]=r.useState([]),[i,h]=r.useState(!1),[u,j]=r.useState(!1),[m,x]=r.useState({}),s=r.useRef(null),p=r.useCallback(v=>{v.preventDefault(),h(!0)},[]),y=r.useCallback(v=>{v.preventDefault(),h(!1)},[]),d=r.useCallback(v=>{v.preventDefault(),h(!1);const c=Array.from(v.dataTransfer.files);o(w=>[...w,...c])},[]),f=v=>{const c=Array.from(v.target.files);o(w=>[...w,...c])},N=v=>{o(c=>c.filter((w,z)=>z!==v))},F=v=>{if(v===0)return"0 B";const c=1024,w=["B","KB","MB","GB"],z=Math.floor(Math.log(v)/Math.log(c));return parseFloat((v/Math.pow(c,z)).toFixed(2))+" "+w[z]},C=()=>{if(n.length===0)return;j(!0);const v=new FormData;n.forEach(c=>{v.append("files[]",c)}),t&&v.append("folder_id",t),W.post("/files/upload",v,{forceFormData:!0,onProgress:c=>{x({percentage:c.percentage})},onSuccess:()=>{o([]),j(!1),a?.()},onError:()=>{j(!1)}})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{onDragOver:p,onDragLeave:y,onDrop:d,onClick:()=>s.current?.click(),className:`border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all ${i?"border-primary bg-primary-light dropzone-active":"border-border hover:border-primary hover:bg-gray-50"}`,children:[e.jsx("input",{ref:s,type:"file",multiple:!0,onChange:f,className:"hidden"}),e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center ${i?"bg-primary text-white":"bg-primary-light text-primary"}`,children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-text-primary font-medium",children:i?"Drop files here":"Drag & drop files here"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"or click to browse"})]}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Maximum file size: 100MB"})]})]}),n.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-text-primary",children:[n.length," file(s) selected"]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:n.map((v,c)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-light rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-text-primary truncate",children:v.name}),e.jsx("p",{className:"text-xs text-text-secondary",children:F(v.size)})]})]}),!u&&e.jsx("button",{onClick:()=>N(c),className:"p-1 text-text-secondary hover:text-error transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},c))})]}),u&&m.percentage!==void 0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-text-secondary",children:"Uploading..."}),e.jsxs("span",{className:"text-text-primary font-medium",children:[Math.round(m.percentage),"%"]})]}),e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${m.percentage}%`}})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-border",children:[e.jsx(S,{variant:"ghost",onClick:a,children:"Cancel"}),e.jsxs(S,{onClick:C,disabled:n.length===0,loading:u,children:["Upload ",n.length>0&&`(${n.length})`]})]})]})}function Ne({x:t,y:a,file:n,onClose:o,onDownload:i,onRename:h,onDelete:u,onMove:j,onShare:m}){const x=r.useRef(null);return r.useEffect(()=>{const s=y=>{x.current&&!x.current.contains(y.target)&&o()},p=y=>{y.key==="Escape"&&o()};return document.addEventListener("mousedown",s),document.addEventListener("keydown",p),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("keydown",p)}},[o]),r.useEffect(()=>{if(x.current){const s=x.current.getBoundingClientRect(),p=window.innerWidth,y=window.innerHeight;s.right>p&&(x.current.style.left=`${t-s.width}px`),s.bottom>y&&(x.current.style.top=`${a-s.height}px`)}},[t,a]),e.jsxs("div",{ref:x,className:"fixed z-50 bg-card rounded-lg shadow-lg border border-border py-1 min-w-[180px]",style:{left:t,top:a},children:[e.jsxs("button",{onClick:()=>{i(n),o()},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]}),e.jsxs("button",{onClick:()=>{m(n),o()},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Share"]}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsxs("button",{onClick:()=>{h(n),o()},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Rename"]}),e.jsxs("button",{onClick:()=>{j(n),o()},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),"Move to..."]}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsxs("button",{onClick:()=>{u(n),o()},className:"w-full px-4 py-2 text-left text-sm text-error hover:bg-red-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})}const q=()=>{const t=document.querySelector('meta[name="csrf-token"]');return t?t.getAttribute("content"):""};function Ce({isOpen:t,onClose:a,file:n,existingShare:o}){const[i,h]=r.useState("public"),[u,j]=r.useState(""),[m,x]=r.useState(""),[s,p]=r.useState(""),[y,d]=r.useState(!1),[f,N]=r.useState(o||null),[F,C]=r.useState(!1),[v,c]=r.useState("");r.useEffect(()=>{o?(N(o),h(o.share_type),x(o.expires_at?o.expires_at.slice(0,16):""),p(o.max_downloads?.toString()||"")):(N(null),h("public"),j(""),x(""),p("")),c("")},[o,t]);const w=async g=>{g.preventDefault(),d(!0),c("");try{const k=await fetch(`/shares/files/${n.id}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":q()},body:JSON.stringify({share_type:i,password:i==="password"?u:null,expires_at:m||null,max_downloads:s?parseInt(s):null})}),B=await k.json();if(!k.ok)throw new Error(B.message||"Failed to create share link");N(B.share)}catch(k){c(k.message)}finally{d(!1)}},z=async()=>{if(f){d(!0),c("");try{const g=await fetch(`/shares/${f.id}`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":q()},body:JSON.stringify({share_type:i,password:i==="password"&&u?u:null,expires_at:m||null,max_downloads:s?parseInt(s):null})}),k=await g.json();if(!g.ok)throw new Error(k.message||"Failed to update share");N(k.share)}catch(g){c(g.message)}finally{d(!1)}}},A=async()=>{if(f){d(!0),c("");try{const g=await fetch(`/shares/${f.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":q()}});if(!g.ok){const k=await g.json();throw new Error(k.message||"Failed to revoke share")}N(null),h("public"),j(""),x(""),p("")}catch(g){c(g.message)}finally{d(!1)}}},R=async()=>{if(f?.share_url)try{await navigator.clipboard.writeText(f.share_url),C(!0),setTimeout(()=>C(!1),2e3)}catch{const g=document.createElement("textarea");g.value=f.share_url,document.body.appendChild(g),g.select(),document.execCommand("copy"),document.body.removeChild(g),C(!0),setTimeout(()=>C(!1),2e3)}};return e.jsx(T,{isOpen:t,onClose:a,title:`Share "${n?.name}"`,size:"md",children:e.jsxs("div",{className:"space-y-6",children:[v&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-xl text-sm text-error",children:v}),f?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Share Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:f.share_url,className:"flex-1 px-4 py-2.5 border border-border rounded-xl bg-gray-50 text-text-primary text-sm"}),e.jsx(S,{variant:F?"secondary":"primary",onClick:R,children:F?e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-text-secondary uppercase tracking-wider",children:"Downloads"}),e.jsxs("p",{className:"text-2xl font-semibold text-text-primary mt-1",children:[f.access_count,f.max_downloads&&e.jsxs("span",{className:"text-sm font-normal text-text-secondary",children:[" / ",f.max_downloads]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-text-secondary uppercase tracking-wider",children:"Expires"}),e.jsx("p",{className:"text-lg font-semibold text-text-primary mt-1",children:f.expires_at?new Date(f.expires_at).toLocaleDateString():"Never"})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-border",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary",children:"Update Settings"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm text-text-secondary",children:"Access Type"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"shareType",value:"public",checked:i==="public",onChange:g=>h(g.target.value),className:"text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-text-primary",children:"Public"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"shareType",value:"password",checked:i==="password",onChange:g=>h(g.target.value),className:"text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-text-primary",children:"Password Protected"})]})]})]}),i==="password"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm text-text-secondary",children:["New Password ",f.share_type==="password"&&"(leave blank to keep current)"]}),e.jsx("input",{type:"password",value:u,onChange:g=>j(g.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter password"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm text-text-secondary",children:"Expires At"}),e.jsx("input",{type:"datetime-local",value:m,onChange:g=>x(g.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm text-text-secondary",children:"Max Downloads"}),e.jsx("input",{type:"number",value:s,onChange:g=>p(g.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Unlimited",min:"1"})]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(S,{variant:"danger",onClick:A,loading:y,children:"Revoke Link"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(S,{variant:"ghost",onClick:a,children:"Close"}),e.jsx(S,{onClick:z,loading:y,children:"Update"})]})]})]}):e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Access Type"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>h("public"),className:`p-4 rounded-xl border-2 text-left transition-all ${i==="public"?"border-primary bg-primary-light":"border-border hover:border-primary/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${i==="public"?"bg-primary text-white":"bg-gray-100 text-text-secondary"}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("span",{className:"font-medium text-text-primary",children:"Public"})]}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Anyone with the link can download"})]}),e.jsxs("button",{type:"button",onClick:()=>h("password"),className:`p-4 rounded-xl border-2 text-left transition-all ${i==="password"?"border-primary bg-primary-light":"border-border hover:border-primary/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${i==="password"?"bg-primary text-white":"bg-gray-100 text-text-secondary"}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("span",{className:"font-medium text-text-primary",children:"Password"})]}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Requires password to download"})]})]})]}),i==="password"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Password"}),e.jsx("input",{type:"password",value:u,onChange:g=>j(g.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter a secure password",required:i==="password",minLength:4})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Expires At"}),e.jsx("input",{type:"datetime-local",value:m,onChange:g=>x(g.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Leave empty for no expiration"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Max Downloads"}),e.jsx("input",{type:"number",value:s,onChange:g=>p(g.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Unlimited",min:"1"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Leave empty for unlimited"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(S,{type:"button",variant:"ghost",onClick:a,children:"Cancel"}),e.jsx(S,{type:"submit",loading:y,children:"Create Share Link"})]})]})]})})}function Le({file:t,onClose:a,onDownload:n,onShare:o}){const[i,h]=r.useState(!0),[u,j]=r.useState(!1);if(r.useEffect(()=>{const y=d=>{d.key==="Escape"&&a()};return document.addEventListener("keydown",y),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",y),document.body.style.overflow="unset"}},[a]),!t)return null;const m=t.icon_type==="image",x=t.icon_type==="video",s=()=>{h(!1)},p=()=>{h(!1),j(!0)};return ue.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/90 backdrop-blur-sm fade-in",onClick:a}),e.jsx("button",{onClick:a,className:"absolute top-4 right-4 z-10 p-2 rounded-xl bg-white/10 text-white hover:bg-white/20 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-3",children:e.jsxs("div",{className:"px-4 py-2 rounded-xl bg-white/10 backdrop-blur-sm",children:[e.jsx("p",{className:"text-white font-medium truncate max-w-md",children:t.name}),e.jsx("p",{className:"text-white/60 text-sm",children:t.formatted_size})]})}),e.jsxs("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 z-10 flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>n(t),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/10 text-white hover:bg-white/20 transition-colors backdrop-blur-sm",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]}),o&&e.jsxs("button",{onClick:()=>{a(),o(t)},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/10 text-white hover:bg-white/20 transition-colors backdrop-blur-sm",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Share"]})]}),e.jsxs("div",{className:"relative max-w-[90vw] max-h-[85vh] modal-enter",children:[i&&!u&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 border-4 border-white/20 border-t-white rounded-full animate-spin"})}),u&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-white/10 rounded-2xl flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-white/60",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("p",{className:"text-white font-medium mb-1",children:"Unable to load preview"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Download the file to view it"})]}),m&&e.jsx("img",{src:`/files/${t.id}/download`,alt:t.name,className:`max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl ${i?"opacity-0":"opacity-100"} transition-opacity duration-300`,onLoad:s,onError:p}),x&&e.jsx("video",{src:`/files/${t.id}/download`,controls:!0,autoPlay:!0,className:`max-w-full max-h-[85vh] rounded-lg shadow-2xl ${i?"opacity-0":"opacity-100"} transition-opacity duration-300`,onLoadedData:s,onError:p})]})]}),document.body)}function Me(t="created_at",a="desc"){const[n,o]=r.useState(t),[i,h]=r.useState(a),u=[{value:"name",label:"Name"},{value:"created_at",label:"Date uploaded"},{value:"size",label:"Size"},{value:"extension",label:"Type"}],j=r.useCallback(x=>{let s="asc";x===n?s=i==="asc"?"desc":"asc":s=x==="created_at"||x==="size"?"desc":"asc",o(x),h(s),W.get(window.location.pathname,{...Object.fromEntries(new URLSearchParams(window.location.search)),sort_by:x,sort_order:s},{preserveState:!0,preserveScroll:!0})},[n,i]),m=r.useCallback(x=>x!==n?null:i==="asc"?"↑":"↓",[n,i]);return{sortBy:n,sortOrder:i,sortOptions:u,handleSort:j,getSortIcon:m}}function Ee({files:t,folders:a,currentFolder:n,breadcrumbs:o,filters:i,stats:h}){const[u,j]=r.useState("grid"),[m,x]=r.useState([]),[s,p]=r.useState(!1),[y,d]=r.useState(!1),[f,N]=r.useState(!1),[F,C]=r.useState(!1),[v,c]=r.useState(!1),[w,z]=r.useState(null),[A,R]=r.useState(null),[g,k]=r.useState(null),[B,P]=r.useState(null),[O,$]=r.useState(null),[L,E]=r.useState(null),[b,M]=r.useState(""),[_,V]=r.useState(""),{sortBy:re,sortOrder:se,handleSort:ne}=Me(i.sort_by||"created_at",i.sort_order||"desc"),G=r.useCallback((l,D=!1)=>{if(D){x([]);return}x(H=>H.includes(l)?H.filter(ee=>ee!==l):[...H,l])},[]),J=r.useCallback((l,D)=>{l.preventDefault(),P({x:l.clientX,y:l.clientY}),E(D)},[]),Y=r.useCallback((l,D)=>{l.preventDefault(),$({x:l.clientX,y:l.clientY}),E(D)},[]),U=l=>{W.get("/files",{folder_id:l})},I=l=>{window.location.href=`/files/${l.id}/download`},ae=l=>{k(l)},Q=l=>{E(l),V(l.name),N(!0)},Z=l=>{E(l),C(!0)},oe=l=>{W.patch(`/files/${l.id}/move`,{folder_id:null})},K=async l=>{z(l),R(null);try{const H=await(await fetch(`/shares/files/${l.id}`,{headers:{Accept:"application/json"}})).json();H.share&&R(H.share)}catch{}c(!0)},le=l=>{l.preventDefault(),W.post("/folders",{name:b,parent_id:n?.id||null},{onSuccess:()=>{d(!1),M("")}})},ie=l=>{l.preventDefault();const D=!L.extension,H=D?`/folders/${L.id}`:`/files/${L.id}/rename`;W["patch"](H,{name:_},{onSuccess:()=>{N(!1),E(null),V("")}})},ce=()=>{const D=!L.extension?`/folders/${L.id}`:`/files/${L.id}`;W.delete(D,{onSuccess:()=>{C(!1),E(null)}})},de=()=>{m.length!==0&&W.post("/files/bulk-delete",{file_ids:m},{onSuccess:()=>x([])})},xe=l=>{W.get("/files",{...Object.fromEntries(new URLSearchParams(window.location.search)),folder_id:n?.id,type:l==="all"?void 0:l},{preserveState:!0})};return e.jsxs(me,{title:"My Files",children:[e.jsx(he,{title:"My Files"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(S,{onClick:()=>p(!0),children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Upload"]}),e.jsxs(S,{variant:"secondary",onClick:()=>d(!0),children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),"New Folder"]}),m.length>0&&e.jsxs(S,{variant:"danger",onClick:de,children:["Delete (",m.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[e.jsx("div",{className:"flex-1 sm:w-72",children:e.jsx(ve,{initialValue:i.search||""})}),e.jsxs("div",{className:"flex items-center border border-border rounded-lg",children:[e.jsx("button",{onClick:()=>j("grid"),className:`p-2 ${u==="grid"?"bg-primary-light text-primary":"text-text-secondary hover:bg-gray-50"}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsx("button",{onClick:()=>j("list"),className:`p-2 ${u==="list"?"bg-primary-light text-primary":"text-text-secondary hover:bg-gray-50"}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(X,{href:"/files",className:"text-primary hover:text-primary-hover font-medium",children:"My Files"}),o.map((l,D)=>e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),D===o.length-1?e.jsx("span",{className:"text-text-primary font-medium",children:l.name}):e.jsx(X,{href:`/files?folder_id=${l.id}`,className:"text-primary hover:text-primary-hover",children:l.name})]},l.id))]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["all","image","video","audio","document","archive"].map(l=>e.jsx("button",{onClick:()=>xe(l),className:`px-3 py-1.5 text-sm rounded-full transition-colors ${(i.type||"all")===l?"bg-primary text-white":"bg-gray-100 text-text-secondary hover:bg-gray-200"}`,children:l.charAt(0).toUpperCase()+l.slice(1)},l))}),e.jsxs("div",{className:"text-sm text-text-secondary",children:[h.file_count," files · ",h.total_size," used"]}),u==="grid"?e.jsx(be,{files:t.data,folders:a,selectedFiles:m,onSelectFile:G,onContextMenu:J,onOpenFolder:U,onFolderContextMenu:Y,onPreview:ae,onDownload:I,onShare:K}):e.jsx(we,{files:t.data,folders:a,selectedFiles:m,onSelectFile:G,onContextMenu:J,onOpenFolder:U,onFolderContextMenu:Y,sortBy:re,sortOrder:se,onSort:ne}),t.last_page>1&&e.jsx("div",{className:"flex justify-center gap-2",children:t.links.map((l,D)=>e.jsx(X,{href:l.url||"#",className:`px-3 py-1 rounded ${l.active?"bg-primary text-white":l.url?"bg-gray-100 text-text-secondary hover:bg-gray-200":"bg-gray-50 text-gray-300 cursor-not-allowed"}`,dangerouslySetInnerHTML:{__html:l.label}},D))})]}),e.jsx(T,{isOpen:s,onClose:()=>p(!1),title:"Upload Files",size:"lg",children:e.jsx(ke,{folderId:n?.id,onClose:()=>p(!1)})}),e.jsx(T,{isOpen:y,onClose:()=>d(!1),title:"Create New Folder",children:e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Folder Name"}),e.jsx("input",{type:"text",value:b,onChange:l=>M(l.target.value),className:"w-full px-4 py-2.5 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter folder name",autoFocus:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(S,{variant:"ghost",onClick:()=>d(!1),children:"Cancel"}),e.jsx(S,{type:"submit",disabled:!b.trim(),children:"Create"})]})]})}),e.jsx(T,{isOpen:f,onClose:()=>N(!1),title:`Rename ${L?.extension?"File":"Folder"}`,children:e.jsxs("form",{onSubmit:ie,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"New Name"}),e.jsx("input",{type:"text",value:_,onChange:l=>V(l.target.value),className:"w-full px-4 py-2.5 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",autoFocus:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(S,{variant:"ghost",onClick:()=>N(!1),children:"Cancel"}),e.jsx(S,{type:"submit",disabled:!_.trim(),children:"Rename"})]})]})}),e.jsx(T,{isOpen:F,onClose:()=>C(!1),title:`Delete ${L?.extension?"File":"Folder"}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-text-secondary",children:["Are you sure you want to delete ",e.jsx("strong",{children:L?.name}),"?",!L?.extension&&" All files inside will also be deleted.","This action cannot be undone."]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(S,{variant:"ghost",onClick:()=>C(!1),children:"Cancel"}),e.jsx(S,{variant:"danger",onClick:ce,children:"Delete"})]})]})}),B&&L&&e.jsx(Ne,{x:B.x,y:B.y,file:L,onClose:()=>{P(null),E(null)},onDownload:I,onRename:Q,onDelete:Z,onMove:oe,onShare:K}),e.jsx(Ce,{isOpen:v,onClose:()=>{c(!1),z(null),R(null)},file:w,existingShare:A}),g&&e.jsx(Le,{file:g,onClose:()=>k(null),onDownload:I,onShare:K}),O&&L&&e.jsxs("div",{className:"fixed z-50 bg-card rounded-lg shadow-lg border border-border py-1 min-w-[180px]",style:{left:O.x,top:O.y},children:[e.jsxs("button",{onClick:()=>{U(L.id),$(null)},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),"Open"]}),e.jsxs("button",{onClick:()=>{Q(L),$(null)},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Rename"]}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsxs("button",{onClick:()=>{Z(L),$(null)},className:"w-full px-4 py-2 text-left text-sm text-error hover:bg-red-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]}),O&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>{$(null),E(null)}})]})}export{Ee as default};
