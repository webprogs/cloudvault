import{r,j as e,a as H,b as K,c as He,H as Ve,L as re}from"./app-BkR4kAKC.js";import{A as Ge}from"./AppLayout-DU10v_Wh.js";import{B as T}from"./Button-CHU0Urfk.js";import{M as q}from"./Modal-CXHsxJWj.js";function Ke(t,o,l,d){var i=this,c=r.useRef(null),x=r.useRef(0),w=r.useRef(0),v=r.useRef(null),h=r.useRef([]),n=r.useRef(),a=r.useRef(),y=r.useRef(t),N=r.useRef(!0),D=r.useRef(),B=r.useRef();y.current=t;var O=typeof window<"u",z=!o&&o!==0&&O;if(typeof t!="function")throw new TypeError("Expected a function");o=+o||0;var u=!!(l=l||{}).leading,f=!("trailing"in l)||!!l.trailing,F=!!l.flushOnExit&&f,R="maxWait"in l,M="debounceOnServer"in l&&!!l.debounceOnServer,j=R?Math.max(+l.maxWait||0,o):null,b=r.useMemo(function(){var _=function(L){var E=h.current,W=n.current;return h.current=n.current=null,x.current=L,w.current=w.current||L,a.current=y.current.apply(W,E)},g=function(L,E){z&&cancelAnimationFrame(v.current),v.current=z?requestAnimationFrame(L):setTimeout(L,E)},k=function(L){if(!N.current)return!1;var E=L-c.current;return!c.current||E>=o||E<0||R&&L-x.current>=j},s=function(L){return v.current=null,f&&h.current?_(L):(h.current=n.current=null,a.current)},m=function L(){var E=Date.now();if(u&&w.current===x.current&&C(),k(E))return s(E);if(N.current){var W=o-(E-c.current),A=R?Math.min(W,j-(E-x.current)):W;g(L,A)}},C=function(){},S=function(){if(O||M){var L,E=Date.now(),W=k(E);if(h.current=[].slice.call(arguments),n.current=i,c.current=E,F&&!D.current&&(D.current=function(){var A;((A=global.document)==null?void 0:A.visibilityState)==="hidden"&&B.current.flush()},(L=global.document)==null||L.addEventListener==null||L.addEventListener("visibilitychange",D.current)),W){if(!v.current&&N.current)return x.current=c.current,g(m,o),u?_(c.current):a.current;if(R)return g(m,o),_(c.current)}return v.current||g(m,o),a.current}};return S.cancel=function(){var L=v.current;L&&(z?cancelAnimationFrame(v.current):clearTimeout(v.current)),x.current=0,h.current=c.current=n.current=v.current=null},S.isPending=function(){return!!v.current},S.flush=function(){return v.current?s(Date.now()):a.current},S},[u,R,o,j,f,F,z,O,M,d]);return B.current=b,r.useEffect(function(){return N.current=!0,function(){var _;F&&B.current.flush(),D.current&&((_=global.document)==null||_.removeEventListener==null||_.removeEventListener("visibilitychange",D.current),D.current=null),N.current=!1}},[F]),b}function Je(t){const[o,l]=r.useState(!1),[d,i]=r.useState(!1),[c,x]=r.useState(null);r.useEffect(()=>{const h=window.SpeechRecognition||window.webkitSpeechRecognition;i(!!h)},[]);const w=r.useCallback(()=>{if(!d){x("Voice search is not supported in this browser");return}const h=window.SpeechRecognition||window.webkitSpeechRecognition,n=new h;n.continuous=!1,n.interimResults=!1,n.lang="en-US",n.onstart=()=>{l(!0),x(null)},n.onresult=a=>{const y=a.results[0][0].transcript;t(y),l(!1)},n.onerror=a=>{x(a.error==="not-allowed"?"Microphone access denied":"Voice search error: "+a.error),l(!1)},n.onend=()=>{l(!1)};try{n.start()}catch{x("Failed to start voice search"),l(!1)}},[d,t]),v=r.useCallback(()=>{l(!1)},[]);return{isListening:o,isSupported:d,error:c,startListening:w,stopListening:v}}function Xe({onResult:t}){const{isListening:o,isSupported:l,error:d,startListening:i}=Je(t);return l?e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:i,disabled:o,className:`p-1.5 rounded-md transition-colors ${o?"text-primary bg-primary-light":"text-text-secondary hover:text-text-primary hover:bg-gray-100"}`,title:o?"Listening...":"Voice search",children:e.jsxs("div",{className:"relative",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})}),o&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-error rounded-full voice-active"})]})}),d&&e.jsx("div",{className:"absolute top-full right-0 mt-2 px-3 py-2 bg-error text-white text-xs rounded-lg whitespace-nowrap z-10",children:d})]}):null}function qe({initialValue:t="",placeholder:o="Search files..."}){const[l,d]=r.useState(t),[i,c]=r.useState(!1),x=Ke(n=>{H.get(window.location.pathname,{...Object.fromEntries(new URLSearchParams(window.location.search)),search:n||void 0},{preserveState:!0,preserveScroll:!0})},300),w=n=>{const a=n.target.value;d(a),x(a)},v=r.useCallback(n=>{d(n),x(n)},[x]),h=()=>{d(""),x("")};return e.jsx("div",{className:"relative flex items-center",children:e.jsxs("div",{className:`relative flex-1 transition-all duration-200 ${i?"scale-[1.02]":""}`,children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx("svg",{className:`h-5 w-5 transition-colors ${i?"text-primary":"text-text-secondary"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:l,onChange:w,onFocus:()=>c(!0),onBlur:()=>c(!1),placeholder:o,className:`block w-full pl-12 pr-24 py-3 border rounded-xl bg-card text-text-primary placeholder-text-secondary transition-all duration-200 ${i?"border-primary ring-4 ring-primary/10 shadow-lg":"border-border hover:border-gray-300 shadow-sm"}`}),e.jsxs("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 gap-1",children:[l&&e.jsx("button",{onClick:h,className:"p-2 rounded-lg text-text-secondary hover:text-text-primary hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx(Xe,{onResult:v})]})]})})}function be({size:t="sm"}){const o={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"};return e.jsx("div",{className:"inline-flex items-center justify-center text-primary",title:"This file is shared",children:e.jsx("svg",{className:o[t],fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})})}function Qe({file:t,selected:o,onSelect:l,onContextMenu:d,onPreview:i,onDownload:c,onShare:x,onDragStart:w,onDragEnd:v}){const[h,n]=r.useState(!1),[a,y]=r.useState(!1),N=r.useRef(null);r.useEffect(()=>{const j=b=>{N.current&&!N.current.contains(b.target)&&y(!1)};return document.addEventListener("mousedown",j),()=>document.removeEventListener("mousedown",j)},[]);const D=j=>{const b={image:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),video:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),audio:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"})}),document:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),archive:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),file:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})};return b[j]||b.file},B={image:"text-green-500 bg-green-50",video:"text-purple-500 bg-purple-50",audio:"text-pink-500 bg-pink-50",document:"text-blue-500 bg-blue-50",archive:"text-yellow-500 bg-yellow-50",file:"text-gray-500 bg-gray-50"},O=t.icon_type==="image",z=t.icon_type==="video",u=O||z,f=j=>{j.ctrlKey||j.metaKey?l(t.id):u&&i&&i(t)},F=()=>{c&&c(t)},R=j=>{j.dataTransfer.setData("application/json",JSON.stringify({type:"file",id:t.id})),j.dataTransfer.effectAllowed="move",w&&w(t,"file")},M=()=>{v&&v()};return e.jsxs("div",{draggable:!0,onDragStart:R,onDragEnd:M,className:`group relative bg-card border rounded-2xl p-4 transition-all duration-200 cursor-pointer card-hover ${o?"border-primary ring-2 ring-primary/20 shadow-md":"border-border hover:border-primary/40 hover:shadow-lg"}`,onClick:f,onDoubleClick:F,onContextMenu:j=>{j.preventDefault(),d(j,t)},children:[e.jsx("div",{className:`absolute top-3 left-3 w-5 h-5 rounded-lg border-2 flex items-center justify-center transition-all duration-200 z-10 ${o?"bg-primary border-primary shadow-sm":"border-border bg-white opacity-0 group-hover:opacity-100 hover:border-primary/50"}`,onClick:j=>{j.stopPropagation(),l(t.id)},children:o&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"absolute top-3 right-3 z-10",ref:N,children:[e.jsx("button",{className:`p-1.5 rounded-xl transition-all duration-200 ${a?"bg-gray-100 opacity-100":"hover:bg-gray-100 opacity-0 group-hover:opacity-100"}`,onClick:j=>{j.stopPropagation(),y(!a)},children:e.jsx("svg",{className:"w-5 h-5 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),a&&e.jsxs("div",{className:"absolute right-0 mt-1 w-44 bg-card rounded-xl shadow-xl border border-border py-1.5 slide-up",children:[u&&i&&e.jsxs("button",{onClick:j=>{j.stopPropagation(),y(!1),i(t)},className:"w-full px-4 py-2.5 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Preview"]}),e.jsxs("button",{onClick:j=>{j.stopPropagation(),y(!1),c&&c(t)},className:"w-full px-4 py-2.5 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]}),x&&e.jsxs("button",{onClick:j=>{j.stopPropagation(),y(!1),x(t)},className:"w-full px-4 py-2.5 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Share"]}),e.jsx("div",{className:"my-1.5 border-t border-border"}),e.jsxs("button",{onClick:j=>{j.stopPropagation(),y(!1),d(j,t)},className:"w-full px-4 py-2.5 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"More options..."]})]})]}),e.jsx("div",{className:"flex justify-center mb-4 mt-2",children:O&&!h?e.jsx("div",{className:"w-full h-32 rounded-xl overflow-hidden bg-gray-100 relative",children:e.jsx("img",{src:t.thumbnail_url||`/files/${t.id}/download`,alt:t.name,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",onError:()=>n(!0)})}):z?e.jsxs("div",{className:"w-full h-32 rounded-xl overflow-hidden bg-gray-900 relative flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-white ml-0.5",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})}),e.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center ${B.video}`,children:D("video")})]}):e.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center ${B[t.icon_type]} transition-transform duration-200 group-hover:scale-110`,children:D(t.icon_type)})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[e.jsx("p",{className:"text-sm font-medium text-text-primary truncate max-w-[140px]",title:t.name,children:t.name}),t.is_shared&&e.jsx(be,{size:"sm"})]}),e.jsx("p",{className:"text-xs text-text-secondary mt-1.5",children:t.formatted_size})]})]})}function Ye({folder:t,onOpen:o,onContextMenu:l,onDrop:d,onDragStart:i,onDragEnd:c,selected:x,onSelect:w,selectable:v}){const[h,n]=r.useState(!1),a=u=>{u.dataTransfer.setData("application/json",JSON.stringify({type:"folder",id:t.id})),u.dataTransfer.effectAllowed="move",i&&i(t,"folder")},y=()=>{n(!1),c&&c()},N=u=>{u.preventDefault(),u.dataTransfer.dropEffect="move"},D=u=>{u.preventDefault();try{u.dataTransfer.types.includes("application/json")&&n(!0)}catch{n(!0)}},B=u=>{u.currentTarget.contains(u.relatedTarget)||n(!1)},O=u=>{u.preventDefault(),n(!1);try{const f=JSON.parse(u.dataTransfer.getData("application/json"));if(f.type==="folder"&&f.id===t.id)return;d&&d(f.id,f.type,t.id)}catch(f){console.error("Drop error:",f)}},z=u=>{u.ctrlKey||u.metaKey?w&&(u.stopPropagation(),w(t.id)):o()};return e.jsxs("div",{draggable:!0,onDragStart:a,onDragEnd:y,onDragOver:N,onDragEnter:D,onDragLeave:B,onDrop:O,className:`group relative bg-card border rounded-2xl p-4 transition-all duration-200 cursor-pointer card-hover ${h?"border-primary ring-2 ring-primary/40 bg-primary-light/30":x?"border-primary ring-2 ring-primary/20 shadow-md":"border-border hover:border-primary/40 hover:shadow-lg"}`,onClick:z,onContextMenu:u=>{u.preventDefault(),l(u,t)},children:[v&&e.jsx("div",{className:`absolute top-3 left-3 w-5 h-5 rounded-lg border-2 flex items-center justify-center transition-all duration-200 z-10 ${x?"bg-primary border-primary shadow-sm":"border-border bg-white opacity-0 group-hover:opacity-100 hover:border-primary/50"}`,onClick:u=>{u.stopPropagation(),w&&w(t.id)},children:x&&e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:`w-16 h-16 rounded-2xl flex items-center justify-center bg-gradient-to-br from-primary-light to-blue-100 text-primary transition-transform duration-200 group-hover:scale-110 ${h?"scale-110":""}`,children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})})}),e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-sm font-medium text-text-primary truncate max-w-[140px] mx-auto",title:t.name,children:t.name})}),e.jsx("button",{className:"absolute top-3 right-3 p-1.5 rounded-xl opacity-0 group-hover:opacity-100 hover:bg-gray-100 transition-all duration-200",onClick:u=>{u.stopPropagation(),l(u,t)},children:e.jsx("svg",{className:"w-5 h-5 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})]})}function Ie({files:t,folders:o,selectedFiles:l,onSelectFile:d,onContextMenu:i,onOpenFolder:c,onFolderContextMenu:x,onPreview:w,onDownload:v,onShare:h,onDropToFolder:n,selectedFolders:a,onSelectFolder:y}){return t.length===0&&o.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-50 rounded-3xl flex items-center justify-center mb-6",children:e.jsx("svg",{className:"w-12 h-12 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"No files yet"}),e.jsx("p",{className:"text-text-secondary",children:"Upload files to get started"})]}):e.jsxs("div",{className:"space-y-6",children:[o.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Folders"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:o.map(N=>e.jsx(Ye,{folder:N,onOpen:()=>c(N.id),onContextMenu:x,onDrop:n,selected:a?.includes(N.id),onSelect:y,selectable:!!y},N.id))})]}),t.length>0&&e.jsxs("div",{children:[o.length>0&&e.jsx("h3",{className:"text-sm font-medium text-text-secondary mb-3",children:"Files"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:t.map(N=>e.jsx(Qe,{file:N,selected:l.includes(N.id),onSelect:d,onContextMenu:i,onPreview:w,onDownload:v,onShare:h},N.id))})]})]})}function Ze({files:t,folders:o,selectedFiles:l,onSelectFile:d,onContextMenu:i,onOpenFolder:c,onFolderContextMenu:x,sortBy:w,sortOrder:v,onSort:h,onDropToFolder:n,selectedFolders:a,onSelectFolder:y}){const[N,D]=r.useState(null),B=u=>{h(u)},O=u=>u!==w?null:e.jsx("svg",{className:`w-4 h-4 inline ml-1 transition-transform ${v==="desc"?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 15l7-7 7 7"})}),z=u=>new Date(u).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return t.length===0&&o.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-gray-100 to-gray-50 rounded-3xl flex items-center justify-center mb-6",children:e.jsx("svg",{className:"w-12 h-12 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-text-primary mb-2",children:"No files yet"}),e.jsx("p",{className:"text-text-secondary",children:"Upload files to get started"})]}):e.jsx("div",{className:"bg-card border border-border rounded-2xl overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50/80 border-b border-border",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10 px-4 py-4",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded-md border-border cursor-pointer",checked:l.length===t.length&&t.length>0,onChange:()=>{l.length===t.length?d(null,!0):t.forEach(u=>d(u.id))}})}),e.jsxs("th",{className:"px-4 py-4 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider cursor-pointer hover:text-text-primary transition-colors",onClick:()=>B("name"),children:["Name ",O("name")]}),e.jsxs("th",{className:"px-4 py-4 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider cursor-pointer hover:text-text-primary transition-colors hidden sm:table-cell",onClick:()=>B("created_at"),children:["Date ",O("created_at")]}),e.jsxs("th",{className:"px-4 py-4 text-left text-xs font-semibold text-text-secondary uppercase tracking-wider cursor-pointer hover:text-text-primary transition-colors hidden md:table-cell",onClick:()=>B("size"),children:["Size ",O("size")]}),e.jsx("th",{className:"w-10 px-4 py-4"})]})}),e.jsxs("tbody",{className:"divide-y divide-border/60",children:[o.map(u=>e.jsxs("tr",{draggable:!0,onDragStart:f=>{f.dataTransfer.setData("application/json",JSON.stringify({type:"folder",id:u.id})),f.dataTransfer.effectAllowed="move"},onDragOver:f=>{f.preventDefault(),f.dataTransfer.dropEffect="move"},onDragEnter:f=>{f.preventDefault(),D(u.id)},onDragLeave:f=>{f.currentTarget.contains(f.relatedTarget)||D(null)},onDrop:f=>{f.preventDefault(),D(null);try{const F=JSON.parse(f.dataTransfer.getData("application/json"));if(F.type==="folder"&&F.id===u.id)return;n&&n(F.id,F.type,u.id)}catch(F){console.error("Drop error:",F)}},className:`cursor-pointer transition-colors ${N===u.id?"bg-primary-light/50 ring-2 ring-primary/40":a?.includes(u.id)?"bg-primary-light/30":"hover:bg-gray-50/60"}`,onClick:f=>{f.ctrlKey||f.metaKey?y&&y(u.id):c(u.id)},onContextMenu:f=>{f.preventDefault(),x(f,u)},children:[e.jsx("td",{className:"px-4 py-4",children:y?e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded-md border-border cursor-pointer",checked:a?.includes(u.id),onChange:()=>y(u.id),onClick:f=>f.stopPropagation()}):e.jsx("div",{className:"w-5"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-11 h-11 rounded-xl bg-gradient-to-br from-primary-light to-blue-100 flex items-center justify-center shrink-0 transition-transform ${N===u.id?"scale-110":""}`,children:e.jsx("svg",{className:"w-5 h-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),e.jsx("span",{className:"font-medium text-text-primary",children:u.name})]})}),e.jsx("td",{className:"px-4 py-4 text-sm text-text-secondary hidden sm:table-cell",children:z(u.created_at)}),e.jsx("td",{className:"px-4 py-4 text-sm text-text-secondary hidden md:table-cell",children:"â€”"}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("button",{onClick:f=>{f.stopPropagation(),x(f,u)},className:"p-1.5 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]},`folder-${u.id}`)),t.map(u=>e.jsxs("tr",{draggable:!0,onDragStart:f=>{f.dataTransfer.setData("application/json",JSON.stringify({type:"file",id:u.id})),f.dataTransfer.effectAllowed="move"},className:`hover:bg-gray-50/60 transition-colors ${l.includes(u.id)?"bg-primary-light/30":""}`,onContextMenu:f=>{f.preventDefault(),i(f,u)},children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded-md border-border cursor-pointer",checked:l.includes(u.id),onChange:()=>d(u.id)})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-11 h-11 rounded-xl bg-gray-100 flex items-center justify-center shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-text-primary truncate",children:u.name}),u.is_shared&&e.jsx(be,{size:"sm"})]}),e.jsx("p",{className:"text-xs text-text-secondary uppercase",children:u.extension})]})]})}),e.jsx("td",{className:"px-4 py-4 text-sm text-text-secondary hidden sm:table-cell",children:z(u.created_at)}),e.jsx("td",{className:"px-4 py-4 text-sm text-text-secondary hidden md:table-cell",children:u.formatted_size}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("button",{onClick:f=>{f.stopPropagation(),i(f,u)},className:"p-1.5 rounded-lg hover:bg-gray-100 transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})})]},`file-${u.id}`))]})]})})}function et({files:t,uploadStates:o,onRemove:l,onCancel:d,onRetry:i,formatFileSize:c}){const x=h=>{switch(h){case"completed":return"text-green-600";case"error":return"text-red-600";case"cancelled":return"text-gray-500";case"processing":return"text-blue-600";default:return"text-primary"}},w=h=>{switch(h){case"initializing":return"Initializing...";case"uploading":return"Uploading...";case"processing":return"Processing...";case"completed":return"Completed";case"error":return"Failed";case"cancelled":return"Cancelled";default:return"Pending"}},v=h=>{switch(h){case"completed":return"bg-green-500";case"error":return"bg-red-500";case"cancelled":return"bg-gray-400";case"processing":return"bg-blue-500";default:return"bg-primary"}};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-text-primary",children:[t.length," file(s) selected"]}),e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-3",children:t.map((h,n)=>{const a=o[n]||{status:"pending",progress:0},y=["initializing","uploading","processing"].includes(a.status);return e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${a.status==="completed"?"bg-green-100":a.status==="error"?"bg-red-100":"bg-primary-light"}`,children:a.status==="completed"?e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):a.status==="error"?e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}):y?e.jsxs("svg",{className:"w-5 h-5 text-primary animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"w-5 h-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-text-primary truncate",children:h.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:c(h.size)}),e.jsx("span",{className:`${x(a.status)}`,children:w(a.status)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[a.status==="error"&&e.jsx("button",{onClick:()=>i(n),className:"p-1.5 text-primary hover:bg-primary-light rounded-lg transition-colors",title:"Retry",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),y&&e.jsx("button",{onClick:()=>d(n),className:"p-1.5 text-text-secondary hover:text-error hover:bg-red-50 rounded-lg transition-colors",title:"Cancel",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),!y&&e.jsx("button",{onClick:()=>l(n),className:"p-1.5 text-text-secondary hover:text-error hover:bg-red-50 rounded-lg transition-colors",title:"Remove",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]}),(y||a.status==="completed")&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:a.status==="processing"?"Processing on server...":a.status==="completed"?"Upload complete":`Uploading chunk ${a.uploadedChunks||0} of ${a.totalChunks||"?"}`}),e.jsxs("span",{className:"text-text-primary font-medium",children:[Math.round(a.progress||0),"%"]})]}),e.jsx("div",{className:"h-1.5 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 ${v(a.status)} ${a.status==="processing"?"animate-pulse":""}`,style:{width:`${a.progress||0}%`}})})]}),a.status==="error"&&a.error&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:a.error})]},`${h.name}-${n}`)})})]})}const tt=3;function rt({folderId:t,onClose:o,onUploadComplete:l}){const[d,i]=r.useState([]),[c,x]=r.useState({}),[w,v]=r.useState(!1),[h,n]=r.useState(!1),a=r.useRef(null),y=r.useRef({});r.useEffect(()=>()=>{Object.values(y.current).forEach(s=>{s?.abort()})},[]);const N=r.useCallback(s=>{s.preventDefault(),v(!0)},[]),D=r.useCallback(s=>{s.preventDefault(),v(!1)},[]),B=r.useCallback(s=>{s.preventDefault(),v(!1);const m=Array.from(s.dataTransfer.files);z(m)},[]),O=s=>{const m=Array.from(s.target.files);z(m),s.target.value=""},z=s=>{i(m=>{const C=new Set(m.map(L=>L.name)),S=s.filter(L=>!C.has(L.name));return[...m,...S]})},u=s=>{d[s],c[s]?.sessionId&&j(s),i(m=>m.filter((C,S)=>S!==s)),x(m=>{const C={...m};return delete C[s],C})},f=s=>{if(s===0)return"0 B";const m=1024,C=["B","KB","MB","GB","TB"],S=Math.floor(Math.log(s)/Math.log(m));return parseFloat((s/Math.pow(m,S)).toFixed(2))+" "+C[S]},F=async(s,m)=>{try{y.current[m]=new AbortController,x(W=>({...W,[m]:{status:"initializing",progress:0,error:null}}));const C=await K.post("/api/uploads/initiate",{filename:s.name,file_size:s.size,folder_id:t},{signal:y.current[m]?.signal}),{session_id:S,chunk_size:L,total_chunks:E}=C.data;x(W=>({...W,[m]:{sessionId:S,status:"uploading",progress:0,uploadedChunks:[],totalChunks:E,chunkSize:L,error:null}})),await R(s,m,S,L,E)}catch(C){if(K.isCancel(C))return;x(S=>({...S,[m]:{...S[m],status:"error",error:C.response?.data?.message||C.response?.data?.errors?.[0]||"Failed to initialize upload"}}))}},R=async(s,m,C,S,L)=>{const E=[];for(let P=0;P<L;P++){const G=P*S,J=Math.min(G+S,s.size);E.push({index:P,start:G,end:J})}const W=[...E],A=new Set,V=async()=>{for(;W.length>0||A.size>0;){if(y.current[m]?.signal?.aborted)return;for(;A.size<tt&&W.length>0;){const P=W.shift(),G=M(s,m,C,P).catch(J=>{if(!K.isCancel(J))if(!P.retries||P.retries<3)P.retries=(P.retries||0)+1,W.push(P);else throw J}).finally(()=>{A.delete(G)});A.add(G)}A.size>0&&await Promise.race(A)}};try{await V()}catch(P){K.isCancel(P)||x(G=>({...G,[m]:{...G[m],status:"error",error:P.response?.data?.message||"Upload failed"}}))}},M=async(s,m,C,S)=>{const L=s.slice(S.start,S.end),E=new FormData;E.append("chunk",L),E.append("chunk_index",S.index);const W=await K.post(`/api/uploads/${C}/chunk`,E,{headers:{"Content-Type":"multipart/form-data"},signal:y.current[m]?.signal});return x(A=>{const V=A[m];if(!V)return A;const P=W.data.status==="assembling"?"processing":W.data.status==="completed"?"completed":"uploading";return{...A,[m]:{...V,progress:W.data.progress,uploadedChunks:W.data.uploaded_chunks,status:P}}}),W.data.status==="completed"&&l?.(),W.data},j=async s=>{const m=c[s];if(m?.sessionId){y.current[s]?.abort();try{await K.delete(`/api/uploads/${m.sessionId}`)}catch{}x(C=>({...C,[s]:{...C[s],status:"cancelled"}}))}},b=async s=>{const m=d[s];m&&(y.current[s]=new AbortController,x(C=>({...C,[s]:{status:"initializing",progress:0,error:null}})),await F(m,s))},_=async()=>{if(d.length===0||h)return;n(!0);const s=d.map((m,C)=>{const S=c[C];return S?.status==="completed"||S?.status==="uploading"||S?.status==="processing"?Promise.resolve():F(m,C)});await Promise.allSettled(s),n(!1)},g=d.length>0&&d.every((s,m)=>c[m]?.status==="completed");Object.values(c).some(s=>s?.status==="error");const k=Object.values(c).some(s=>s?.status==="uploading"||s?.status==="processing"||s?.status==="initializing");return e.jsxs("div",{className:"space-y-4",children:[!h&&!k&&e.jsxs("div",{onDragOver:N,onDragLeave:D,onDrop:B,onClick:()=>a.current?.click(),className:`border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all ${w?"border-primary bg-primary-light dropzone-active":"border-border hover:border-primary hover:bg-gray-50"}`,children:[e.jsx("input",{ref:a,type:"file",multiple:!0,onChange:O,className:"hidden"}),e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center ${w?"bg-primary text-white":"bg-primary-light text-primary"}`,children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-text-primary font-medium",children:w?"Drop files here":"Drag & drop files here"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"or click to browse"})]}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Maximum file size: 10GB (large files upload in chunks)"})]})]}),d.length>0&&e.jsx(et,{files:d,uploadStates:c,onRemove:u,onCancel:j,onRetry:b,formatFileSize:f}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-border",children:[e.jsx(T,{variant:"ghost",onClick:o,children:g?"Close":"Cancel"}),!g&&e.jsx(T,{onClick:_,disabled:d.length===0||k,loading:k,children:k?"Uploading...":`Upload ${d.length>0?`(${d.length})`:""}`}),g&&e.jsx(T,{onClick:()=>{l?.(),o?.()},children:"Done"})]})]})}const se=100*1024*1024;function st({folderId:t,onClose:o}){const[l,d]=r.useState([]),[i,c]=r.useState(!1),[x,w]=r.useState(!1),[v,h]=r.useState({}),[n,a]=r.useState(!1),y=r.useRef(null),N=r.useCallback(M=>{M.preventDefault(),c(!0)},[]),D=r.useCallback(M=>{M.preventDefault(),c(!1)},[]),B=r.useCallback(M=>{M.preventDefault(),c(!1);const j=Array.from(M.dataTransfer.files);z(j)},[]),O=M=>{const j=Array.from(M.target.files);z(j),M.target.value=""},z=M=>{M.some(b=>b.size>se)?(a(!0),d(b=>[...b,...M])):d(b=>[...b,...M])},u=M=>{d(j=>{const b=j.filter((_,g)=>g!==M);return b.some(_=>_.size>se)||a(!1),b})},f=M=>{if(M===0)return"0 B";const j=1024,b=["B","KB","MB","GB","TB"],_=Math.floor(Math.log(M)/Math.log(j));return parseFloat((M/Math.pow(j,_)).toFixed(2))+" "+b[_]},F=()=>{if(l.length===0)return;w(!0);const M=new FormData;l.forEach(j=>{M.append("files[]",j)}),t&&M.append("folder_id",t),H.post("/files/upload",M,{forceFormData:!0,onProgress:j=>{h({percentage:j.percentage})},onSuccess:()=>{d([]),w(!1),o?.()},onError:()=>{w(!1)}})},R=()=>{H.reload({only:["files","stats"]})};return n||l.some(M=>M.size>se)?e.jsx(rt,{folderId:t,onClose:()=>{d([]),a(!1),o?.()},onUploadComplete:R}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{onDragOver:N,onDragLeave:D,onDrop:B,onClick:()=>y.current?.click(),className:`border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all ${i?"border-primary bg-primary-light dropzone-active":"border-border hover:border-primary hover:bg-gray-50"}`,children:[e.jsx("input",{ref:y,type:"file",multiple:!0,onChange:O,className:"hidden"}),e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:`w-16 h-16 rounded-full flex items-center justify-center ${i?"bg-primary text-white":"bg-primary-light text-primary"}`,children:e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-text-primary font-medium",children:i?"Drop files here":"Drag & drop files here"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"or click to browse"})]}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Files up to 10GB supported (large files use chunked upload)"})]})]}),l.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-text-primary",children:[l.length," file(s) selected"]}),e.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2",children:l.map((M,j)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-light rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-text-primary truncate",children:M.name}),e.jsx("p",{className:"text-xs text-text-secondary",children:f(M.size)})]})]}),!x&&e.jsx("button",{onClick:()=>u(j),className:"p-1 text-text-secondary hover:text-error transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},j))})]}),x&&v.percentage!==void 0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-text-secondary",children:"Uploading..."}),e.jsxs("span",{className:"text-text-primary font-medium",children:[Math.round(v.percentage),"%"]})]}),e.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${v.percentage}%`}})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-border",children:[e.jsx(T,{variant:"ghost",onClick:o,children:"Cancel"}),e.jsxs(T,{onClick:F,disabled:l.length===0,loading:x,children:["Upload ",l.length>0&&`(${l.length})`]})]})]})}function at({x:t,y:o,file:l,onClose:d,onDownload:i,onRename:c,onDelete:x,onMove:w,onShare:v}){const h=r.useRef(null);return r.useEffect(()=>{const n=y=>{h.current&&!h.current.contains(y.target)&&d()},a=y=>{y.key==="Escape"&&d()};return document.addEventListener("mousedown",n),document.addEventListener("keydown",a),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("keydown",a)}},[d]),r.useEffect(()=>{if(h.current){const n=h.current.getBoundingClientRect(),a=window.innerWidth,y=window.innerHeight;n.right>a&&(h.current.style.left=`${t-n.width}px`),n.bottom>y&&(h.current.style.top=`${o-n.height}px`)}},[t,o]),e.jsxs("div",{ref:h,className:"fixed z-50 bg-card rounded-lg shadow-lg border border-border py-1 min-w-[180px]",style:{left:t,top:o},children:[e.jsxs("button",{onClick:()=>{i(l),d()},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]}),e.jsxs("button",{onClick:()=>{v(l),d()},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Share"]}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsxs("button",{onClick:()=>{c(l),d()},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Rename"]}),e.jsxs("button",{onClick:()=>{w(l),d()},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Move to..."]}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsxs("button",{onClick:()=>{x(l),d()},className:"w-full px-4 py-2 text-left text-sm text-error hover:bg-red-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]})}const ae=()=>{const t=document.querySelector('meta[name="csrf-token"]');return t?t.getAttribute("content"):""};function nt({isOpen:t,onClose:o,file:l,existingShare:d}){const[i,c]=r.useState("public"),[x,w]=r.useState(""),[v,h]=r.useState(""),[n,a]=r.useState(""),[y,N]=r.useState(!1),[D,B]=r.useState(d||null),[O,z]=r.useState(!1),[u,f]=r.useState("");r.useEffect(()=>{d?(B(d),c(d.share_type),h(d.expires_at?d.expires_at.slice(0,16):""),a(d.max_downloads?.toString()||"")):(B(null),c("public"),w(""),h(""),a("")),f("")},[d,t]);const F=async b=>{b.preventDefault(),N(!0),f("");try{const _=await fetch(`/shares/files/${l.id}`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":ae()},body:JSON.stringify({share_type:i,password:i==="password"?x:null,expires_at:v||null,max_downloads:n?parseInt(n):null})}),g=await _.json();if(!_.ok)throw new Error(g.message||"Failed to create share link");B(g.share)}catch(_){f(_.message)}finally{N(!1)}},R=async()=>{if(D){N(!0),f("");try{const b=await fetch(`/shares/${D.id}`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":ae()},body:JSON.stringify({share_type:i,password:i==="password"&&x?x:null,expires_at:v||null,max_downloads:n?parseInt(n):null})}),_=await b.json();if(!b.ok)throw new Error(_.message||"Failed to update share");B(_.share)}catch(b){f(b.message)}finally{N(!1)}}},M=async()=>{if(D){N(!0),f("");try{const b=await fetch(`/shares/${D.id}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":ae()}});if(!b.ok){const _=await b.json();throw new Error(_.message||"Failed to revoke share")}B(null),c("public"),w(""),h(""),a("")}catch(b){f(b.message)}finally{N(!1)}}},j=async()=>{if(D?.share_url)try{await navigator.clipboard.writeText(D.share_url),z(!0),setTimeout(()=>z(!1),2e3)}catch{const b=document.createElement("textarea");b.value=D.share_url,document.body.appendChild(b),b.select(),document.execCommand("copy"),document.body.removeChild(b),z(!0),setTimeout(()=>z(!1),2e3)}};return e.jsx(q,{isOpen:t,onClose:o,title:`Share "${l?.name}"`,size:"md",children:e.jsxs("div",{className:"space-y-6",children:[u&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-xl text-sm text-error",children:u}),D?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Share Link"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",readOnly:!0,value:D.share_url,className:"flex-1 px-4 py-2.5 border border-border rounded-xl bg-gray-50 text-text-primary text-sm"}),e.jsx(T,{variant:O?"secondary":"primary",onClick:j,children:O?e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-text-secondary uppercase tracking-wider",children:"Downloads"}),e.jsxs("p",{className:"text-2xl font-semibold text-text-primary mt-1",children:[D.access_count,D.max_downloads&&e.jsxs("span",{className:"text-sm font-normal text-text-secondary",children:[" / ",D.max_downloads]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl",children:[e.jsx("p",{className:"text-xs text-text-secondary uppercase tracking-wider",children:"Expires"}),e.jsx("p",{className:"text-lg font-semibold text-text-primary mt-1",children:D.expires_at?new Date(D.expires_at).toLocaleDateString():"Never"})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t border-border",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary",children:"Update Settings"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm text-text-secondary",children:"Access Type"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"shareType",value:"public",checked:i==="public",onChange:b=>c(b.target.value),className:"text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-text-primary",children:"Public"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"shareType",value:"password",checked:i==="password",onChange:b=>c(b.target.value),className:"text-primary focus:ring-primary"}),e.jsx("span",{className:"text-sm text-text-primary",children:"Password Protected"})]})]})]}),i==="password"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm text-text-secondary",children:["New Password ",D.share_type==="password"&&"(leave blank to keep current)"]}),e.jsx("input",{type:"password",value:x,onChange:b=>w(b.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter password"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm text-text-secondary",children:"Expires At"}),e.jsx("input",{type:"datetime-local",value:v,onChange:b=>h(b.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm text-text-secondary",children:"Max Downloads"}),e.jsx("input",{type:"number",value:n,onChange:b=>a(b.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Unlimited",min:"1"})]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(T,{variant:"danger",onClick:M,loading:y,children:"Revoke Link"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(T,{variant:"ghost",onClick:o,children:"Close"}),e.jsx(T,{onClick:R,loading:y,children:"Update"})]})]})]}):e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Access Type"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>c("public"),className:`p-4 rounded-xl border-2 text-left transition-all ${i==="public"?"border-primary bg-primary-light":"border-border hover:border-primary/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${i==="public"?"bg-primary text-white":"bg-gray-100 text-text-secondary"}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("span",{className:"font-medium text-text-primary",children:"Public"})]}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Anyone with the link can download"})]}),e.jsxs("button",{type:"button",onClick:()=>c("password"),className:`p-4 rounded-xl border-2 text-left transition-all ${i==="password"?"border-primary bg-primary-light":"border-border hover:border-primary/50"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${i==="password"?"bg-primary text-white":"bg-gray-100 text-text-secondary"}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("span",{className:"font-medium text-text-primary",children:"Password"})]}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Requires password to download"})]})]})]}),i==="password"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Password"}),e.jsx("input",{type:"password",value:x,onChange:b=>w(b.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter a secure password",required:i==="password",minLength:4})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Expires At"}),e.jsx("input",{type:"datetime-local",value:v,onChange:b=>h(b.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Leave empty for no expiration"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary",children:"Max Downloads"}),e.jsx("input",{type:"number",value:n,onChange:b=>a(b.target.value),className:"w-full px-4 py-2.5 border border-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Unlimited",min:"1"}),e.jsx("p",{className:"text-xs text-text-secondary",children:"Leave empty for unlimited"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(T,{type:"button",variant:"ghost",onClick:o,children:"Cancel"}),e.jsx(T,{type:"submit",loading:y,children:"Create Share Link"})]})]})]})})}function ot({file:t,onClose:o,onDownload:l,onShare:d}){const[i,c]=r.useState(!0),[x,w]=r.useState(!1);if(r.useEffect(()=>{const y=N=>{N.key==="Escape"&&o()};return document.addEventListener("keydown",y),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",y),document.body.style.overflow="unset"}},[o]),!t)return null;const v=t.icon_type==="image",h=t.icon_type==="video",n=()=>{c(!1)},a=()=>{c(!1),w(!0)};return He.createPortal(e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/90 backdrop-blur-sm fade-in",onClick:o}),e.jsx("button",{onClick:o,className:"absolute top-4 right-4 z-10 p-2 rounded-xl bg-white/10 text-white hover:bg-white/20 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-3",children:e.jsxs("div",{className:"px-4 py-2 rounded-xl bg-white/10 backdrop-blur-sm",children:[e.jsx("p",{className:"text-white font-medium truncate max-w-md",children:t.name}),e.jsx("p",{className:"text-white/60 text-sm",children:t.formatted_size})]})}),e.jsxs("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 z-10 flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>l(t),className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/10 text-white hover:bg-white/20 transition-colors backdrop-blur-sm",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]}),d&&e.jsxs("button",{onClick:()=>{o(),d(t)},className:"flex items-center gap-2 px-4 py-2.5 rounded-xl bg-white/10 text-white hover:bg-white/20 transition-colors backdrop-blur-sm",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Share"]})]}),e.jsxs("div",{className:"relative max-w-[90vw] max-h-[85vh] modal-enter",children:[i&&!x&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-12 h-12 border-4 border-white/20 border-t-white rounded-full animate-spin"})}),x&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 text-center",children:[e.jsx("div",{className:"w-20 h-20 bg-white/10 rounded-2xl flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-white/60",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("p",{className:"text-white font-medium mb-1",children:"Unable to load preview"}),e.jsx("p",{className:"text-white/60 text-sm",children:"Download the file to view it"})]}),v&&e.jsx("img",{src:t.preview_url||`/files/${t.id}/download`,alt:t.name,className:`max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl ${i?"opacity-0":"opacity-100"} transition-opacity duration-300`,onLoad:n,onError:a}),h&&e.jsx("video",{src:t.preview_url||`/files/${t.id}/download`,controls:!0,autoPlay:!0,className:`max-w-full max-h-[85vh] rounded-lg shadow-2xl ${i?"opacity-0":"opacity-100"} transition-opacity duration-300`,onLoadedData:n,onError:a})]})]}),document.body)}function we({folder:t,selectedId:o,onSelect:l,disabledIds:d,level:i=0}){const[c,x]=r.useState(!0),w=t.children&&t.children.length>0,v=d.includes(t.id),h=o===t.id;return e.jsxs("div",{children:[e.jsxs("div",{className:`flex items-center gap-2 py-2 px-3 rounded-lg cursor-pointer transition-colors ${v?"opacity-50 cursor-not-allowed":h?"bg-primary text-white":"hover:bg-gray-100"}`,style:{paddingLeft:`${i*16+12}px`},onClick:()=>{v||l(t.id)},children:[w?e.jsx("button",{onClick:n=>{n.stopPropagation(),x(!c)},className:`p-0.5 rounded transition-colors ${h?"hover:bg-white/20":"hover:bg-gray-200"}`,children:e.jsx("svg",{className:`w-4 h-4 transition-transform ${c?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}):e.jsx("div",{className:"w-5"}),e.jsx("svg",{className:"w-5 h-5 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),e.jsx("span",{className:"truncate text-sm font-medium",children:t.name})]}),w&&c&&e.jsx("div",{children:t.children.map(n=>e.jsx(we,{folder:n,selectedId:o,onSelect:l,disabledIds:d,level:i+1},n.id))})]})}function lt({folders:t,selectedId:o,onSelect:l,disabledIds:d=[]}){return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:`flex items-center gap-2 py-2 px-3 rounded-lg cursor-pointer transition-colors ${o===null?"bg-primary text-white":"hover:bg-gray-100"}`,onClick:()=>l(null),children:[e.jsx("div",{className:"w-5"}),e.jsx("svg",{className:"w-5 h-5 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),e.jsx("span",{className:"text-sm font-medium",children:"My Files (Root)"})]}),t.map(i=>e.jsx(we,{folder:i,selectedId:o,onSelect:l,disabledIds:d},i.id))]})}function it({isOpen:t,onClose:o,item:l,itemType:d,onMove:i,currentFolderId:c}){const[x,w]=r.useState([]),[v,h]=r.useState(c),[n,a]=r.useState(!1),[y,N]=r.useState(!0);r.useEffect(()=>{t&&(N(!0),h(c),fetch("/folders/tree",{headers:{Accept:"application/json"}}).then(z=>z.json()).then(z=>{w(z.folders||[])}).catch(console.error).finally(()=>N(!1)))},[t,c]);const D=()=>{if(d!=="folder"||!l)return[];const z=[l.id],u=f=>{f.forEach(F=>{if(F.id===l.id){const R=M=>{M.forEach(j=>{z.push(j.id),j.children&&R(j.children)})};F.children&&R(F.children)}else F.children&&u(F.children)})};return u(x),z},B=async()=>{a(!0);try{await i(l.id,d,v),o()}catch(z){console.error("Move failed:",z)}finally{a(!1)}},O=v===c;return e.jsx(q,{isOpen:t,onClose:o,title:`Move ${l?.name||""}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Select a destination folder:"}),y?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("svg",{className:"animate-spin h-6 w-6 text-primary",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}):e.jsx("div",{className:"max-h-64 overflow-y-auto border border-border rounded-lg p-2",children:e.jsx(lt,{folders:x,selectedId:v,onSelect:h,disabledIds:D()})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(T,{variant:"ghost",onClick:o,children:"Cancel"}),e.jsx(T,{onClick:B,disabled:n||O,children:n?"Moving...":"Move"})]})]})})}function ct({isOpen:t,onClose:o,selectedFolders:l,onSubmit:d}){const[i,c]=r.useState(""),[x,w]=r.useState(!1),v=async n=>{if(n.preventDefault(),!!i.trim()){w(!0);try{await d(i.trim()),c(""),o()}catch(a){console.error("Group failed:",a)}finally{w(!1)}}},h=()=>{c(""),o()};return e.jsx(q,{isOpen:t,onClose:h,title:"Group Folders",children:e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-text-secondary",children:"Create a new folder containing the selected folders:"}),e.jsx("div",{className:"max-h-32 overflow-y-auto border border-border rounded-lg p-3 bg-gray-50",children:e.jsx("ul",{className:"space-y-1",children:l.map(n=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx("svg",{className:"w-4 h-4 text-primary shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),e.jsx("span",{className:"text-text-primary truncate",children:n.name})]},n.id))})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"New Folder Name"}),e.jsx("input",{type:"text",value:i,onChange:n=>c(n.target.value),className:"w-full px-4 py-2.5 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter folder name",autoFocus:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx(T,{variant:"ghost",type:"button",onClick:h,children:"Cancel"}),e.jsx(T,{type:"submit",disabled:!i.trim()||x,children:x?"Creating...":"Group Folders"})]})]})})}function dt({isVisible:t,folderName:o}){return t?e.jsxs("div",{className:"fixed inset-0 z-50 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-primary/10 backdrop-blur-sm"}),e.jsx("div",{className:"absolute inset-4 border-4 border-dashed border-primary rounded-2xl"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"bg-card rounded-2xl shadow-2xl p-8 text-center max-w-md mx-4",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("svg",{className:"w-10 h-10 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsx("h3",{className:"text-xl font-semibold text-text-primary mb-2",children:"Drop files to upload"}),e.jsxs("p",{className:"text-sm text-text-secondary",children:["Files will be uploaded to"," ",e.jsx("span",{className:"font-medium text-text-primary",children:o})]})]})})]}):null}const ye=100*1024*1024;function ut({files:t,folderId:o,onComplete:l,onClose:d}){const[i,c]=r.useState({}),[x,w]=r.useState(!1),[v,h]=r.useState(!1),n=r.useRef({}),a=g=>{if(g===0)return"0 B";const k=1024,s=["B","KB","MB","GB","TB"],m=Math.floor(Math.log(g)/Math.log(k));return parseFloat((g/Math.pow(k,m)).toFixed(2))+" "+s[m]};r.useEffect(()=>{t.length>0&&!v&&(h(!0),y())},[t,v]),r.useEffect(()=>()=>{Object.values(n.current).forEach(g=>{g?.abort()})},[]);const y=async()=>{const g={};t.forEach((k,s)=>{g[s]={status:"pending",progress:0}}),c(g);for(let k=0;k<t.length;k++){const s=t[k];s.size>ye?await D(s,k):await N(s,k)}l?.()},N=async(g,k)=>{try{n.current[k]=new AbortController,c(m=>({...m,[k]:{status:"uploading",progress:0}}));const s=new FormData;s.append("files[]",g),o&&s.append("folder_id",o),await K.post("/files/upload",s,{headers:{"Content-Type":"multipart/form-data"},signal:n.current[k]?.signal,onUploadProgress:m=>{const C=Math.round(m.loaded/m.total*100);c(S=>({...S,[k]:{status:"uploading",progress:C}}))}}),c(m=>({...m,[k]:{status:"completed",progress:100}}))}catch(s){if(K.isCancel(s))return;c(m=>({...m,[k]:{status:"error",progress:0,error:s.response?.data?.message||"Upload failed"}}))}},D=async(g,k)=>{try{n.current[k]=new AbortController,c(L=>({...L,[k]:{status:"initializing",progress:0}}));const s=await K.post("/api/uploads/initiate",{filename:g.name,file_size:g.size,folder_id:o},{signal:n.current[k]?.signal}),{session_id:m,chunk_size:C,total_chunks:S}=s.data;c(L=>({...L,[k]:{status:"uploading",progress:0,sessionId:m,totalChunks:S,uploadedChunks:0}}));for(let L=0;L<S;L++){if(n.current[k]?.signal?.aborted)return;const E=L*C,W=Math.min(E+C,g.size),A=g.slice(E,W),V=new FormData;V.append("chunk",A),V.append("chunk_index",L);const P=await K.post(`/api/uploads/${m}/chunk`,V,{headers:{"Content-Type":"multipart/form-data"},signal:n.current[k]?.signal}),G=P.data.status==="assembling"?"processing":P.data.status==="completed"?"completed":"uploading";c(J=>({...J,[k]:{...J[k],status:G,progress:P.data.progress,uploadedChunks:P.data.uploaded_chunks}}))}}catch(s){if(K.isCancel(s))return;c(m=>({...m,[k]:{status:"error",progress:0,error:s.response?.data?.message||"Upload failed"}}))}},B=async g=>{const k=i[g];if(n.current[g]?.abort(),k?.sessionId)try{await K.delete(`/api/uploads/${k.sessionId}`)}catch{}c(s=>({...s,[g]:{...s[g],status:"cancelled"}}))},O=async g=>{const k=t[g];if(!k)return;n.current[g]=new AbortController,k.size>ye?await D(k,g):await N(k,g);const m={...i};m[g]={status:"completed",progress:100},Object.values(m).every(S=>S.status==="completed"||S.status==="cancelled")&&l?.()},z=t.length,u=Object.values(i).filter(g=>g.status==="completed").length,f=Object.values(i).some(g=>g.status==="error"),F=Object.values(i).some(g=>["uploading","processing","initializing"].includes(g.status)),R=z>0&&Object.values(i).every(g=>g.status==="completed"||g.status==="cancelled"||g.status==="error"),M=z>0?Math.round(Object.values(i).reduce((g,k)=>g+(k.progress||0),0)/z):0,j=g=>{switch(g){case"completed":return"text-green-600";case"error":return"text-red-600";case"cancelled":return"text-gray-500";case"processing":return"text-blue-600";default:return"text-primary"}},b=g=>{switch(g){case"initializing":return"Initializing...";case"uploading":return"Uploading...";case"processing":return"Processing...";case"completed":return"Completed";case"error":return"Failed";case"cancelled":return"Cancelled";default:return"Pending"}},_=g=>{switch(g){case"completed":return"bg-green-500";case"error":return"bg-red-500";case"cancelled":return"bg-gray-400";case"processing":return"bg-blue-500";default:return"bg-primary"}};return e.jsxs("div",{className:"fixed bottom-4 right-4 z-40 w-96 max-w-[calc(100vw-2rem)] bg-card rounded-xl shadow-2xl border border-border overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gray-50 border-b border-border cursor-pointer",onClick:()=>w(!x),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[F?e.jsx("div",{className:"w-5 h-5 border-2 border-primary border-t-transparent rounded-full animate-spin"}):R&&!f?e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):f?e.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-5 h-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-text-primary",children:F?`Uploading ${u}/${z}`:R&&!f?`${u} files uploaded`:f?"Upload completed with errors":"Preparing upload..."}),F&&e.jsxs("p",{className:"text-xs text-text-secondary",children:[M,"% complete"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"p-1 text-text-secondary hover:text-text-primary transition-colors",onClick:g=>{g.stopPropagation(),w(!x)},children:e.jsx("svg",{className:`w-4 h-4 transform transition-transform ${x?"":"rotate-180"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}),R&&e.jsx("button",{className:"p-1 text-text-secondary hover:text-error transition-colors",onClick:g=>{g.stopPropagation(),d?.()},children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),x&&F&&e.jsx("div",{className:"h-1 bg-gray-200",children:e.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${M}%`}})}),!x&&e.jsx("div",{className:"max-h-64 overflow-y-auto p-3 space-y-2",children:t.map((g,k)=>{const s=i[k]||{status:"pending",progress:0},m=["initializing","uploading","processing"].includes(s.status);return e.jsxs("div",{className:"p-2 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${s.status==="completed"?"bg-green-100":s.status==="error"?"bg-red-100":"bg-primary-light"}`,children:s.status==="completed"?e.jsx("svg",{className:"w-4 h-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}):s.status==="error"?e.jsx("svg",{className:"w-4 h-4 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):m?e.jsxs("svg",{className:"w-4 h-4 text-primary animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):e.jsx("svg",{className:"w-4 h-4 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-text-primary truncate",children:g.name}),e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsx("span",{className:"text-text-secondary",children:a(g.size)}),e.jsx("span",{className:"text-text-secondary",children:"Â·"}),e.jsx("span",{className:j(s.status),children:b(s.status)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[s.status==="error"&&e.jsx("button",{onClick:()=>O(k),className:"p-1 text-primary hover:bg-primary-light rounded transition-colors",title:"Retry",children:e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})}),m&&e.jsx("button",{onClick:()=>B(k),className:"p-1 text-text-secondary hover:text-error hover:bg-red-50 rounded transition-colors",title:"Cancel",children:e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),(m||s.status==="completed")&&e.jsx("div",{className:"mt-2 h-1 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-300 ${_(s.status)} ${s.status==="processing"?"animate-pulse":""}`,style:{width:`${s.progress||0}%`}})}),s.status==="error"&&s.error&&e.jsx("p",{className:"text-xs text-red-600 mt-1 truncate",title:s.error,children:s.error})]},`${g.name}-${k}`)})})]})}function ht(t="created_at",o="desc"){const[l,d]=r.useState(t),[i,c]=r.useState(o),x=[{value:"name",label:"Name"},{value:"created_at",label:"Date uploaded"},{value:"size",label:"Size"},{value:"extension",label:"Type"}],w=r.useCallback(h=>{let n="asc";h===l?n=i==="asc"?"desc":"asc":n=h==="created_at"||h==="size"?"desc":"asc",d(h),c(n),H.get(window.location.pathname,{...Object.fromEntries(new URLSearchParams(window.location.search)),sort_by:h,sort_order:n},{preserveState:!0,preserveScroll:!0})},[l,i]),v=r.useCallback(h=>h!==l?null:i==="asc"?"â†‘":"â†“",[l,i]);return{sortBy:l,sortOrder:i,sortOptions:x,handleSort:w,getSortIcon:v}}function xt({onFileDrop:t,enabled:o=!0}){const[l,d]=r.useState(!1),i=r.useRef(0),c=r.useCallback(a=>a.dataTransfer.types.includes("Files")&&!a.dataTransfer.types.includes("application/json"),[]),x=r.useCallback(a=>{a.preventDefault(),a.stopPropagation(),o&&c(a)&&(i.current++,i.current===1&&d(!0))},[o,c]),w=r.useCallback(a=>{a.preventDefault(),a.stopPropagation(),o&&(i.current--,i.current===0&&d(!1))},[o]),v=r.useCallback(a=>{a.preventDefault(),a.stopPropagation(),o&&c(a)&&(a.dataTransfer.dropEffect="copy")},[o,c]),h=r.useCallback(a=>{if(a.preventDefault(),a.stopPropagation(),i.current=0,d(!1),!o||!c(a))return;const y=Array.from(a.dataTransfer.files);y.length>0&&t&&t(y)},[o,c,t]);return r.useEffect(()=>{o||(i.current=0,d(!1))},[o]),r.useEffect(()=>()=>{i.current=0},[]),{isDragOver:l,dragHandlers:{onDragEnter:x,onDragLeave:w,onDragOver:v,onDrop:h}}}function vt({files:t,folders:o,currentFolder:l,breadcrumbs:d,filters:i,stats:c}){const[x,w]=r.useState("grid"),[v,h]=r.useState([]),[n,a]=r.useState(!1),[y,N]=r.useState(!1),[D,B]=r.useState(!1),[O,z]=r.useState(!1),[u,f]=r.useState(!1),[F,R]=r.useState(null),[M,j]=r.useState(null),[b,_]=r.useState(null),[g,k]=r.useState(null),[s,m]=r.useState(null),[C,S]=r.useState(null),[L,E]=r.useState(null),[W,A]=r.useState(""),[V,P]=r.useState(""),[G,J]=r.useState(!1),[Y,ne]=r.useState(null),[oe,le]=r.useState(null),[Q,ie]=r.useState([]),[ke,ce]=r.useState(!1),[Ne,de]=r.useState([]),[Ce,ue]=r.useState(!1),{sortBy:Le,sortOrder:Me,handleSort:Se}=ht(i.sort_by||"created_at",i.sort_order||"desc"),De=r.useCallback(p=>{de(p),ue(!0)},[]),{isDragOver:ze,dragHandlers:Fe}=xt({onFileDrop:De,enabled:!n}),he=r.useCallback((p,$=!1)=>{if($){h([]);return}h(U=>U.includes(p)?U.filter(X=>X!==p):[...U,p])},[]),xe=r.useCallback((p,$)=>{p.preventDefault(),k({x:p.clientX,y:p.clientY}),S($)},[]),me=r.useCallback((p,$)=>{p.preventDefault(),m({x:p.clientX,y:p.clientY}),S($)},[]),I=p=>{H.get("/files",{folder_id:p})},Z=p=>{window.location.href=`/files/${p.id}/download`},Be=p=>{_(p)},pe=p=>{S(p),P(p.name),B(!0)},ge=p=>{E(p),z(!0)},fe=(p,$=!1)=>{ne(p),le($?"folder":"file"),J(!0)},Ee=(p,$,U)=>new Promise((X,te)=>{const Re=$==="file"?`/files/${p}/move`:`/folders/${p}/move`,Ae=$==="file"?{folder_id:U}:{parent_id:U};H.patch(Re,Ae,{onSuccess:()=>X(),onError:Ue=>te(Ue)})}),ve=(p,$,U)=>{const X=$==="file"?`/files/${p}/move`:`/folders/${p}/move`,te=$==="file"?{folder_id:U}:{parent_id:U};H.patch(X,te)},je=r.useCallback(p=>{ie($=>$.includes(p)?$.filter(U=>U!==p):[...$,p])},[]),_e=p=>new Promise(($,U)=>{H.post("/folders/group",{folder_ids:Q,name:p,parent_id:l?.id||null},{onSuccess:()=>{ie([]),$()},onError:X=>U(X)})}),ee=async p=>{R(p),j(null);try{const U=await(await fetch(`/shares/files/${p.id}`,{headers:{Accept:"application/json"}})).json();U.share&&j(U.share)}catch{}f(!0)},$e=p=>{p.preventDefault(),H.post("/folders",{name:W,parent_id:l?.id||null},{onSuccess:()=>{N(!1),A("")}})},We=p=>{p.preventDefault();const $=!C.extension,U=$?`/folders/${C.id}`:`/files/${C.id}/rename`;H["patch"](U,{name:V},{onSuccess:()=>{B(!1),S(null),P("")}})},Oe=()=>{if(!L)return;const $=!L.extension?`/folders/${L.id}`:`/files/${L.id}`;H.delete($,{onSuccess:()=>{z(!1),E(null)}})},Pe=()=>{v.length!==0&&H.post("/files/bulk-delete",{file_ids:v},{onSuccess:()=>h([])})},Te=p=>{H.get("/files",{...Object.fromEntries(new URLSearchParams(window.location.search)),folder_id:l?.id,type:p==="all"?void 0:p},{preserveState:!0})};return e.jsxs(Ge,{title:"My Files",children:[e.jsx(Ve,{title:"My Files"}),e.jsx(dt,{isVisible:ze,folderName:l?.name||"My Files"}),Ce&&e.jsx(ut,{files:Ne,folderId:l?.id,onComplete:()=>H.reload({only:["files","stats"]}),onClose:()=>{ue(!1),de([])}}),e.jsxs("div",{...Fe,className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(T,{onClick:()=>a(!0),children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"Upload"]}),e.jsxs(T,{variant:"secondary",onClick:()=>N(!0),children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 13h6m-3-3v6m-9 1V7a2 2 0 012-2h6l2 2h6a2 2 0 012 2v8a2 2 0 01-2 2H5a2 2 0 01-2-2z"})}),"New Folder"]}),v.length>0&&e.jsxs(T,{variant:"danger",onClick:Pe,children:["Delete (",v.length,")"]}),Q.length>=2&&e.jsxs(T,{variant:"secondary",onClick:()=>ce(!0),children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),"Group (",Q.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto",children:[e.jsx("div",{className:"flex-1 sm:w-72",children:e.jsx(qe,{initialValue:i.search||""})}),e.jsxs("div",{className:"flex items-center border border-border rounded-lg",children:[e.jsx("button",{onClick:()=>w("grid"),className:`p-2 ${x==="grid"?"bg-primary-light text-primary":"text-text-secondary hover:bg-gray-50"}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),e.jsx("button",{onClick:()=>w("list"),className:`p-2 ${x==="list"?"bg-primary-light text-primary":"text-text-secondary hover:bg-gray-50"}`,children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})})})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(re,{href:"/files",className:"text-primary hover:text-primary-hover font-medium",children:"My Files"}),d.map((p,$)=>e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),$===d.length-1?e.jsx("span",{className:"text-text-primary font-medium",children:p.name}):e.jsx(re,{href:`/files?folder_id=${p.id}`,className:"text-primary hover:text-primary-hover",children:p.name})]},p.id))]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["all","image","video","audio","document","archive"].map(p=>e.jsx("button",{onClick:()=>Te(p),className:`px-3 py-1.5 text-sm rounded-full transition-colors ${(i.type||"all")===p?"bg-primary text-white":"bg-gray-100 text-text-secondary hover:bg-gray-200"}`,children:p.charAt(0).toUpperCase()+p.slice(1)},p))}),e.jsxs("div",{className:"text-sm text-text-secondary",children:[c.file_count," files Â· ",c.total_size," used"]}),x==="grid"?e.jsx(Ie,{files:t.data,folders:o,selectedFiles:v,onSelectFile:he,onContextMenu:xe,onOpenFolder:I,onFolderContextMenu:me,onPreview:Be,onDownload:Z,onShare:ee,onDropToFolder:ve,selectedFolders:Q,onSelectFolder:je}):e.jsx(Ze,{files:t.data,folders:o,selectedFiles:v,onSelectFile:he,onContextMenu:xe,onOpenFolder:I,onFolderContextMenu:me,sortBy:Le,sortOrder:Me,onSort:Se,onDropToFolder:ve,selectedFolders:Q,onSelectFolder:je}),t.last_page>1&&e.jsx("div",{className:"flex justify-center gap-2",children:t.links.map((p,$)=>e.jsx(re,{href:p.url||"#",className:`px-3 py-1 rounded ${p.active?"bg-primary text-white":p.url?"bg-gray-100 text-text-secondary hover:bg-gray-200":"bg-gray-50 text-gray-300 cursor-not-allowed"}`,dangerouslySetInnerHTML:{__html:p.label}},$))})]}),e.jsx(q,{isOpen:n,onClose:()=>a(!1),title:"Upload Files",size:"lg",children:e.jsx(st,{folderId:l?.id,onClose:()=>a(!1)})}),e.jsx(q,{isOpen:y,onClose:()=>N(!1),title:"Create New Folder",children:e.jsxs("form",{onSubmit:$e,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"Folder Name"}),e.jsx("input",{type:"text",value:W,onChange:p=>A(p.target.value),className:"w-full px-4 py-2.5 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Enter folder name",autoFocus:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(T,{variant:"ghost",onClick:()=>N(!1),children:"Cancel"}),e.jsx(T,{type:"submit",disabled:!W.trim(),children:"Create"})]})]})}),e.jsx(q,{isOpen:D,onClose:()=>B(!1),title:`Rename ${C?.extension?"File":"Folder"}`,children:e.jsxs("form",{onSubmit:We,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"New Name"}),e.jsx("input",{type:"text",value:V,onChange:p=>P(p.target.value),className:"w-full px-4 py-2.5 border border-border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary",autoFocus:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(T,{variant:"ghost",onClick:()=>B(!1),children:"Cancel"}),e.jsx(T,{type:"submit",disabled:!V.trim(),children:"Rename"})]})]})}),e.jsx(q,{isOpen:O,onClose:()=>{z(!1),E(null)},title:`Delete ${L?.extension?"File":"Folder"}`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-text-secondary",children:["Are you sure you want to delete ",e.jsx("strong",{children:L?.name}),"?",!L?.extension&&" All files inside will also be deleted.","This action cannot be undone."]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(T,{variant:"ghost",onClick:()=>z(!1),children:"Cancel"}),e.jsx(T,{variant:"danger",onClick:Oe,children:"Delete"})]})]})}),g&&C&&e.jsx(at,{x:g.x,y:g.y,file:C,onClose:()=>{k(null),S(null)},onDownload:Z,onRename:pe,onDelete:ge,onMove:fe,onShare:ee}),e.jsx(nt,{isOpen:u,onClose:()=>{f(!1),R(null),j(null)},file:F,existingShare:M}),b&&e.jsx(ot,{file:b,onClose:()=>_(null),onDownload:Z,onShare:ee}),s&&C&&e.jsxs("div",{className:"fixed z-50 bg-card rounded-lg shadow-lg border border-border py-1 min-w-[180px]",style:{left:s.x,top:s.y},children:[e.jsxs("button",{onClick:()=>{I(C.id),m(null)},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),"Open"]}),e.jsxs("button",{onClick:()=>{pe(C),m(null)},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Rename"]}),e.jsxs("button",{onClick:()=>{fe(C,!0),m(null),S(null)},className:"w-full px-4 py-2 text-left text-sm text-text-primary hover:bg-gray-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),"Move to..."]}),e.jsx("div",{className:"my-1 border-t border-border"}),e.jsxs("button",{onClick:()=>{ge(C),m(null)},className:"w-full px-4 py-2 text-left text-sm text-error hover:bg-red-50 flex items-center gap-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]})]}),s&&e.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>{m(null),S(null)}}),e.jsx(it,{isOpen:G,onClose:()=>{J(!1),ne(null),le(null)},item:Y,itemType:oe,onMove:Ee,currentFolderId:oe==="file"?Y?.folder_id:Y?.parent_id}),e.jsx(ct,{isOpen:ke,onClose:()=>ce(!1),selectedFolders:o.filter(p=>Q.includes(p.id)),onSubmit:_e})]})}export{vt as default};
